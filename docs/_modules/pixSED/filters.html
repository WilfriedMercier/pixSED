

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pixSED.filters &#8212; pixSED</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mycss.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pixSED/filters';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Support for LePhare is currently deprecated as it relies on the old Fortran version. Please use Cigale instead.</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/logo1.png" class="logo__image only-light" alt="pixSED documentation - Home"/>
    <script>document.write(`<img src="../../_static/logo1.png" class="logo__image only-dark" alt="pixSED documentation - Home"/>`);</script>
  
  
    <p class="title logo__title">pixSED</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup.html">
                        Installation and setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../nomenclature.html">
                        Nomenclature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../poisson.html">
                        About Poisson noise
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../API/index.html">
                        API
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/WilfriedMercier/SED" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup.html">
                        Installation and setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../nomenclature.html">
                        Nomenclature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../poisson.html">
                        About Poisson noise
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../API/index.html">
                        API
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/WilfriedMercier/SED" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pixSED.filters</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pixSED.filters</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. codeauthor:: Hugo Plombat - LUPM &lt;hugo.plombat@umontpellier.fr&gt; &amp; Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>

<span class="sd">Base classes used to generate resolved stellar and SFR maps with LePhare or Cigale SED fitting codes.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os.path</span>          <span class="k">as</span>     <span class="nn">opath</span>
<span class="kn">import</span> <span class="nn">numpy</span>            <span class="k">as</span>     <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span>  <span class="k">as</span>     <span class="nn">fits</span>
<span class="kn">from</span>   <span class="nn">astropy.table</span>    <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span>   <span class="nn">copy</span>             <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span>   <span class="nn">functools</span>        <span class="kn">import</span> <span class="n">partialmethod</span>

<span class="kn">from</span>   <span class="nn">numpy</span>            <span class="kn">import</span> <span class="n">ndarray</span>
<span class="kn">from</span>   <span class="nn">typing</span>           <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span>   <span class="nn">collections.abc</span>  <span class="kn">import</span> <span class="n">Iterable</span>

<span class="kn">from</span>   <span class="nn">.misc.enum</span>       <span class="kn">import</span> <span class="n">SEDcode</span><span class="p">,</span> <span class="n">CleanMethod</span><span class="p">,</span> <span class="n">TableUnit</span><span class="p">,</span> <span class="n">MagType</span><span class="p">,</span> <span class="n">TableFormat</span><span class="p">,</span> <span class="n">TableType</span>
<span class="kn">from</span>   <span class="nn">.misc.misc</span>       <span class="kn">import</span> <span class="n">ShapeError</span>
<span class="kn">from</span>   <span class="nn">.catalogues</span>      <span class="kn">import</span> <span class="n">LePhareCat</span><span class="p">,</span> <span class="n">CigaleCat</span><span class="p">,</span> <span class="n">Catalogue</span>
<span class="kn">from</span>   <span class="nn">.photometry</span>      <span class="kn">import</span> <span class="n">countToMag</span><span class="p">,</span> <span class="n">countToFlux</span>
<span class="kn">from</span>   <span class="nn">.coloredMessages</span> <span class="kn">import</span> <span class="n">warningMessage</span><span class="p">,</span> <span class="n">errorMessage</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Custom colored messages</span>
<span class="n">WARNING</span> <span class="o">=</span> <span class="n">warningMessage</span><span class="p">(</span><span class="s1">&#39;Warning:&#39;</span><span class="p">)</span>
<span class="n">ERROR</span>   <span class="o">=</span> <span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Filter"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.Filter">[docs]</a><span class="k">class</span> <span class="nc">Filter</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">    </span>
<span class="sd">    Class implementing all data related to a single filter.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Data and variance maps can be given in any units, but the **unit of the variance map is expected to be the square of that of the data map**. No unit check is performed using header information.</span>
<span class="sd">        </span>
<span class="sd">        The code will convert the data map using the **zeropoint** following the expression:</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            d_{\rm{new}} = d_{\rm{original}} \times 10^{-(zpt + 48.6)/2.5}</span>
<span class="sd">            </span>
<span class="sd">        where :math:`d_{\rm{original}}` is the original data map in any arbitrary unit and :math:`d_{\rm{new}}` is the new data map converted in :math:`\rm erg\,s^{-1}\,Hz^{-1}\,cm^{-2}`. Thus, the **zeropoint** must be chosen so that the conversion is properly done to that unit.</span>
<span class="sd">    </span>
<span class="sd">        The variance map will be converted by first taking the square root to have the std and then performing the same conversion as above.</span>
<span class="sd">        </span>
<span class="sd">    .. important::</span>
<span class="sd">        </span>
<span class="sd">        The code assumes by default that all noise types are included in the variance map. If the Poisson noise is missing, one can provide the **file2** parameter which is the file containing the data map convolved by the square of the PSF. The code will then use that file to compute its own Poisson noise that will be added in quadrature to the given variance map.</span>
<span class="sd">    </span>
<span class="sd">    :param str filt: filter name. This name must be compatible with the filter names availble in the chosen SED fitting code.</span>
<span class="sd">    :type filt: :python:`str`</span>
<span class="sd">    :param file: file name of the data flux map. File must exist and be a loadable FITS file.</span>
<span class="sd">    :type file: :python:`str`</span>
<span class="sd">    :param varFile: file name of the variance flux map. File must exist and be a loadable FITS file.</span>
<span class="sd">    :type varFile: :python:`str`</span>
<span class="sd">    :param zeropoint: magnitude zeropoint (see note above)</span>
<span class="sd">    :type zeropoint: :python:`float`</span>
<span class="sd">    </span>
<span class="sd">    **Keyword arguments**</span>
<span class="sd">    </span>
<span class="sd">    :param ext: extension number in the data FITS file</span>
<span class="sd">    :type ext: :python:`int`</span>
<span class="sd">    :param ext2: extension number in the data squared FITS file</span>
<span class="sd">    :type ext2: :python:`int`</span>
<span class="sd">    :param extErr: extension number in the variance FITS file</span>
<span class="sd">    :type extErr: :python:`int`</span>
<span class="sd">    :param file2: file name for the data convolved by the square of the PSF. File must exist and be a loadable FITS file. If :python:`None`, no file is loaded and Poisson noise will not be added to the variance map.</span>
<span class="sd">    :type file2: :python:`str`</span>
<span class="sd">    :param verbose: whether to print info messages or not</span>
<span class="sd">    :type verbose: :python:`bool`</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError:</span>
<span class="sd">            </span>
<span class="sd">        * if **filt** is not of type :python:`str`</span>
<span class="sd">        * if **file** is not of type :python:`str`</span>
<span class="sd">        * if **varFile** is not of type :python:`str`</span>
<span class="sd">        * if **file2** is not :python:`None` and not of type :python:`str`</span>
<span class="sd">        * if **zeropoint** is neither :python:`int` nor :python:`float`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">varFile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zeropoint</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                 <span class="n">ext</span>     <span class="p">:</span> <span class="nb">int</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                 <span class="n">ext2</span>    <span class="p">:</span> <span class="nb">int</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                 <span class="n">extErr</span>  <span class="p">:</span> <span class="nb">int</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">file2</span>   <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span>          <span class="o">=</span> <span class="kc">True</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Init method.&#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;filt parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type list.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;file parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type str.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;varFile parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">varFile</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type str.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">file2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;file2 parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be either of type str or None.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zeropoint</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;zeropoint parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">zeropoint</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type int or float.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;verbose parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type bool.&#39;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>              <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span>               <span class="o">=</span> <span class="n">filt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zpt</span>                  <span class="o">=</span> <span class="n">zeropoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>                <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname2</span>               <span class="o">=</span> <span class="n">file2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ename</span>                <span class="o">=</span> <span class="n">varFile</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadFits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span>  <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ehdr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadFits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ename</span><span class="p">,</span>  <span class="n">ext</span><span class="o">=</span><span class="n">extErr</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdr2</span>             <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data2</span>            <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texp</span>             <span class="o">=</span> <span class="kc">None</span>
        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">WARNING</span><span class="si">}</span><span class="s1"> No data convolved with the square of the PSF was provided. Poisson noise is assumed to be already contained in the variance map.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdr2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadFits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname2</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39; in filter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
         
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39; in filter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1"># Check that exposure time is in the header (otherwise Poisson noise cannot be computed)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">texp</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;TEXPTIME&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">texp</span>         <span class="o">=</span> <span class="mf">1.0</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">WARNING</span><span class="si">}</span><span class="s1"> data header in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1"> does not have TEXPTIME key. A value of 1 has been assumed...&#39;</span><span class="p">)</span>
            
            
    <span class="c1">###############################</span>
    <span class="c1">#       Private methods       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="Filter._mask"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.Filter._mask">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_mask</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Apply the given mask by placing NaN values onto the array.</span>
<span class="sd">        </span>
<span class="sd">        :param ndarary arr: array to mask</span>
<span class="sd">        :type arr: `ndarray`_</span>
<span class="sd">        :param ndarary[bool] mask: mask with boolean values</span>
<span class="sd">        :type mask: `ndarray`_ [:python:`bool`]</span>
<span class="sd">        </span>
<span class="sd">        :returns: array with masked values</span>
<span class="sd">        :rtype: `ndarray`_</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># We make a deep copy to be sure we do not modify the input arrays</span>
        <span class="n">arr</span>       <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
        <span class="k">return</span> <span class="n">arr</span></div>
            
<div class="viewcode-block" id="Filter._checkFile"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.Filter._checkFile">[docs]</a>    <span class="k">def</span> <span class="nf">_checkFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">            </span>
<span class="sd">        Check whether a file exists.</span>
<span class="sd">        </span>
<span class="sd">        :param file: file name</span>
<span class="sd">        :type file: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :returns: </span>
<span class="sd">            </span>
<span class="sd">            * :python:`True` if **file** exists</span>
<span class="sd">            * :python:`False` otherwise</span>
<span class="sd">            </span>
<span class="sd">        :raises TypeError: if **file** is not of type :python:`str`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;file has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> not found.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>
    
<div class="viewcode-block" id="Filter._loadFits"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.Filter._loadFits">[docs]</a>    <span class="k">def</span> <span class="nf">_loadFits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ext</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Load data and header from a FITS file at the given extension.</span>

<span class="sd">        :param file: file name</span>
<span class="sd">        :type file: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param ext: extension to load data from</span>
<span class="sd">        :type ext: :python:`str`</span>

<span class="sd">        :returns: </span>
<span class="sd">            * (None, None) if the file cannot be loaded as a FITS file or if the hdu extension is too large</span>
<span class="sd">            * (header, data)</span>
<span class="sd">            </span>
<span class="sd">        :rtype: (`Astropy Header`_, `ndarray`_)</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **ext** is not an :python:`int`</span>
<span class="sd">        :raises ValueError: if **ext** is negative</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ext has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type int.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ext has value </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1"> but it must be larger than or equal to 0.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkFile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdul</span><span class="p">:</span>
                    <span class="n">hdu</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
                    
            <span class="c1"># If an error is triggered, we always return None, None</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> could not be loaded as a FITS file.&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> extension number </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1"> for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> too large.&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="FilterList"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList">[docs]</a><span class="k">class</span> <span class="nc">FilterList</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">    </span>
<span class="sd">    Base class implementing the object used to stored SED fitting into.</span>
<span class="sd">    </span>
<span class="sd">    :param filters: filters used to perform the SED fitting</span>
<span class="sd">    :type filters: :python:`list` [Filter]</span>
<span class="sd">    </span>
<span class="sd">    **Keyword arguments**</span>
<span class="sd">    </span>
<span class="sd">    :param mask: mask for bad pixels (:python:`True` for bad pixels, :python:`False` for good ones). If :python:`None`, no mask is applied.</span>
<span class="sd">    :type mask: `ndarray`_ [:python:`bool`]</span>
<span class="sd">    :param SEDcode code: code used to perform the SED fitting. Either :py:attr:`~.SEDcode.LEPHARE` or :py:attr:`~.SEDcode.CIGALE` are accepted.</span>
<span class="sd">    :param redshift: redshift of the galaxy</span>
<span class="sd">    :type redshift: :python:`int` or :python:`float`</span>
<span class="sd">    </span>
<span class="sd">    :param \**kwargs: additional parameters to pass to :py:meth:`~.FilterList.setCode` and :py:meth:`~.FilterList.genTable`</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError:</span>
<span class="sd">        </span>
<span class="sd">        * if **filters** is not a :python:`list`</span>
<span class="sd">        * if **redshift** is neither an :python:`int` nor a :python:`float`</span>
<span class="sd">        * if one of the **filters** is not of type :py:class:`~.Filter`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Filter</span><span class="p">],</span> 
                 <span class="n">mask</span>     <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">code</span>     <span class="p">:</span> <span class="n">SEDcode</span>           <span class="o">=</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">CIGALE</span><span class="p">,</span>
                 <span class="n">redshift</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                 <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Init method.&#39;&#39;&#39;</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">redshift</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;redshift parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">redshift</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type int or float.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;filters parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="si">}</span><span class="s1"> but they must be of type list.&#39;</span><span class="p">)</span>
        
        <span class="c1"># :Redshift of the galaxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshift</span> <span class="o">=</span> <span class="n">redshift</span>
        
        <span class="c1"># :Table used by SED fitting code (default is None)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span>    <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#: Mean map used when building the table (default is None, updated each time meanMap method is called)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanMap</span>  <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#: Scale factor used to normalise the data and error maps (default is None, updated each time genTable method is called)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleFac</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#: Filter list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buildFilters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
                    
        <span class="c1"># Check that data in all filters have the same shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkFilters</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39; in filter list&#39;</span><span class="p">)</span>
                    
        <span class="c1">#: Data shape for easy access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="c1"># :Define a mask which hides pixels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>     <span class="o">=</span> <span class="n">mask</span> <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    
        <span class="c1"># Set SED fitting code. This rebuilds the table since SED fitting codes do not expect tables with the same columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCode</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
       
        
    <span class="c1">###############################</span>
    <span class="c1">#       Private methods       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="FilterList._buildFilters"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._buildFilters">[docs]</a>    <span class="k">def</span> <span class="nf">_buildFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Filter</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        :param filters: list of Filter objects</span>
<span class="sd">        :type filters: :python:`Iterable` [:py:class:`~.Filter`]</span>
<span class="sd">        </span>
<span class="sd">        :returns: list of checked Filter objects</span>
<span class="sd">        :rtype: :python:`list` [:py:class:`~.Filter`]</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if one of the **filters** is not of type :py:class:`~.Filter`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filt</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">filt</span><span class="o">.</span><span class="n">filter</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">filter</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">WARNING</span><span class="si">}</span><span class="s1"> filter </span><span class="si">{</span><span class="n">filt</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1"> already present in filter list.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping filter </span><span class="si">{</span><span class="n">filt</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span> <span class="n">Filter</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;One of the filters has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type Filter.&#39;</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">filt</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">hdr</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">ehdr</span><span class="p">]]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping filter </span><span class="si">{</span><span class="n">filt</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
                    
        <span class="k">return</span> <span class="n">out</span></div>
    
<div class="viewcode-block" id="FilterList._checkFilters"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._checkFilters">[docs]</a>    <span class="k">def</span> <span class="nf">_checkFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param msg: message to append to the error message</span>
<span class="sd">        :type msg: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :raises ShapeError: if at least one filter has a different shape</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShapeError</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39; in filter list&#39;</span><span class="p">)</span>
        
        <span class="k">return</span></div>
        
        
    <span class="c1">##################################</span>
    <span class="c1">#       Catalogue creation       #</span>
    <span class="c1">##################################</span>
    
<div class="viewcode-block" id="FilterList.toCatalogue"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.toCatalogue">[docs]</a>    <span class="k">def</span> <span class="nf">toCatalogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Catalogue</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Construct a Catalogue instance given the table associated to the filter list and the given SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            This function should always be used instead of :py:meth:`~._toLePhareCat` or :py:meth:`~._toCigaleCat` private methods as it automatically builds the correct catalogue object.</span>
<span class="sd">            </span>
<span class="sd">            See their definition to know which parameters to pass.</span>
<span class="sd">        </span>
<span class="sd">        :param fname: name of the output file containing the catalogue when it is saved</span>
<span class="sd">        :type fname: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :param \*args: (**Optional**) arguments to pass to the private method building the catalogue</span>
<span class="sd">        :param \**kwargs: (**Optional**) keyword aguments to pass to the private method building the catalogue</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **self.code** is not recognised</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">LEPHARE</span><span class="p">:</span>        
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toLePhareCat</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">CIGALE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toCigaleCat</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Code </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s1"> not recognised.&#39;</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="FilterList._toCigaleCat"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._toCigaleCat">[docs]</a>    <span class="k">def</span> <span class="nf">_toCigaleCat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CigaleCat</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Construct a :py:class:`~.CigaleCat` instance given the table associated to the filter list.</span>
<span class="sd">        </span>
<span class="sd">        :param fname: name of the output file containing the catalogue when it is saved</span>
<span class="sd">        :type fname: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :returns: a Cigale catalogue instance</span>
<span class="sd">        :rtype: :py:class:`~.CigaleCat`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">CIGALE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;code is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s1"> but it needs to be SEDcode.CIGALE to build a Cigale catalogue object.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">CigaleCat</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FilterList._toLePhareCat"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._toLePhareCat">[docs]</a>    <span class="k">def</span> <span class="nf">_toLePhareCat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">tunit</span>   <span class="p">:</span> <span class="n">TableUnit</span>   <span class="o">=</span> <span class="n">TableUnit</span><span class="o">.</span><span class="n">MAG</span><span class="p">,</span> 
                     <span class="n">magtype</span> <span class="p">:</span> <span class="n">MagType</span>     <span class="o">=</span> <span class="n">MagType</span><span class="o">.</span><span class="n">AB</span><span class="p">,</span> 
                     <span class="n">tformat</span> <span class="p">:</span> <span class="n">TableFormat</span> <span class="o">=</span> <span class="n">TableFormat</span><span class="o">.</span><span class="n">MEME</span><span class="p">,</span> 
                     <span class="n">ttype</span>   <span class="p">:</span> <span class="n">TableType</span>   <span class="o">=</span> <span class="n">TableType</span><span class="o">.</span><span class="n">LONG</span><span class="p">,</span> 
                     <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LePhareCat</span><span class="p">:</span>
<span class="w">        </span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Construct a :py:class:`~.LePhareCat` instance given the table associated to the filter list.</span>
<span class="sd">        </span>
<span class="sd">        :param fname: name of the output file containing the catalogue when it is saved</span>
<span class="sd">        :type fname: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param TableUnit tunit: unit of the table data. Must either be :py:attr:`~.TableUnit.MAG` for magnitude or :py:attr:`~.TableUnit.FLUX` for flux.</span>
<span class="sd">        :param MagType magtype: magnitude type if data are in magnitude unit. Must either be :py:attr:`~.MagType.AB` or :py:attr:`~.MagType.VEGA`.</span>
<span class="sd">        :param TableFormat tformat: format of the table. Must either be :py:attr:`~.TableFormat.MEME` if data and error columns are intertwined or :py:attr:`~.TableFormat.MMEE` if columns are first data and then errors.</span>
<span class="sd">        :param TableType ttype: data type. Must either be :py:attr:`~.TableType.SHORT` or :py:attr:`~.TableType.LONG`.</span>
<span class="sd">        </span>
<span class="sd">        :returns: a LePhare catalogue instance</span>
<span class="sd">        :rtype: :py:class:`~.LePhareCat`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">LEPHARE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;code is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s1"> but it needs to be SEDcode.LEPHARE to build a LePhare catalogue object.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">LePhareCat</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">tunit</span><span class="o">=</span><span class="n">tunit</span><span class="p">,</span> <span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span> <span class="n">tformat</span><span class="o">=</span><span class="n">tformat</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="n">ttype</span><span class="p">)</span></div>
        
     
    <span class="c1">################################</span>
    <span class="c1">#        Table creation        #</span>
    <span class="c1">################################</span>
    
<div class="viewcode-block" id="FilterList._LePhareTableFactory"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._LePhareTableFactory">[docs]</a>    <span class="k">def</span> <span class="nf">_LePhareTableFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanMethod</span><span class="p">:</span> <span class="n">CleanMethod</span> <span class="o">=</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">texpFac</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">         </span>
<span class="sd">         Factory function used to build a data table for LePhare SED fitting code.</span>
<span class="sd">         </span>
<span class="sd">         **Keyword arguments**</span>
<span class="sd">         </span>
<span class="sd">         :param CleanMethod cleanMethod: method used to clean pixel with negative values. Accepted values are :py:attr:`~.CleanMethod.ZERO` or :py:attr:`~.CleanMethod.MIN`.</span>
<span class="sd">         :param scaleFactor: factor used to multiply data and std map</span>
<span class="sd">         :type scaleFactor: :python:`int` or :python:`float`</span>
<span class="sd">         :param texpFac: exposure factor used to divide the exposure time when computing Poisson noise. A value of :python:`0` means no Poisson noise is added to the variance map.</span>
<span class="sd">         :type texpFac: :python:`int`</span>
<span class="sd">         </span>
<span class="sd">         :returns: (columns, column names and column types)</span>
<span class="sd">         :rtype: (:python:`list[int/float/str], list[str], list[Any]`)</span>
<span class="sd">         &#39;&#39;&#39;</span>
         
        <span class="c1"># Compute mean map to scale data</span>
        <span class="n">meanMap</span><span class="p">,</span> <span class="n">_</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMeanMap</span><span class="p">(</span><span class="n">maskVal</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">data</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var</span>                <span class="o">=</span> <span class="p">[]</span>
       
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>

            <span class="c1"># Clean and add noise to variance map</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">v</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanAndNoise</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> 
                                                <span class="n">cleanMethod</span> <span class="o">=</span> <span class="n">cleanMethod</span><span class="p">,</span> 
                                                <span class="n">texp</span>        <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">texp</span><span class="p">,</span> 
                                                <span class="n">texpFac</span>     <span class="o">=</span> <span class="n">texpFac</span><span class="p">,</span>
                                                <span class="n">verbose</span>     <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">verbose</span>
                                               <span class="p">)</span>
            
            <span class="c1"># Scale data to have compatible values with LePhare for the flux</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">v</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">meanMap</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">scaleFactor</span><span class="p">)</span>
            
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">v</span><span class="p">)</span>
        
        <span class="c1"># Go to 1D version</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arraysTo1D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Compute std and convert std and data to mJy unit</span>
        <span class="n">dataList</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stdList</span>            <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">mask0</span>              <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
            
            <span class="c1"># 0 values are cast to NaN otherwise corresponding magnitude would be infinite</span>
            <span class="n">mask0</span>          <span class="o">=</span> <span class="n">mask0</span> <span class="o">|</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">d</span><span class="p">[</span>  <span class="n">mask0</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">err</span><span class="p">[</span><span class="n">mask0</span><span class="p">]</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="c1"># Go to mag</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">err</span>         <span class="o">=</span> <span class="n">countToMag</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">zpt</span><span class="p">)</span>
            
            <span class="c1"># Cast back pixels with NaN values to -99 mag to specify they are not to be used in the SED fitting</span>
            <span class="n">d</span><span class="p">[</span>  <span class="n">mask0</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
            <span class="n">err</span><span class="p">[</span><span class="n">mask0</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>
            
            <span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">stdList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">err</span><span class="p">)</span>
            
        <span class="c1"># Redshift column</span>
        <span class="n">lf</span>                         <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">ld</span>                         <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">zs</span>                         <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">redshift</span><span class="p">]</span><span class="o">*</span><span class="n">ld</span>
        
        <span class="c1"># Compute context (number of filters used - see LePhare documentation) and redshift columns</span>
        <span class="n">context</span>                    <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">lf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ld</span>
        <span class="n">dtypes</span>                     <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>     <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">lf</span>                                                       <span class="o">+</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
        <span class="n">colnames</span>                   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>    <span class="o">+</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;e_</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Context&#39;</span><span class="p">,</span> <span class="s1">&#39;zs&#39;</span><span class="p">]</span>
        <span class="n">columns</span>                    <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">stdList</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">]]</span>         <span class="o">+</span> <span class="p">[</span> <span class="n">context</span><span class="p">,</span> <span class="n">zs</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">columns</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">dtypes</span></div>
    
        
<div class="viewcode-block" id="FilterList._CigaleTableFactory"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList._CigaleTableFactory">[docs]</a>    <span class="k">def</span> <span class="nf">_CigaleTableFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanMethod</span><span class="p">:</span> <span class="n">CleanMethod</span> <span class="o">=</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">texpFac</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Factory function used to build a data table for Cigale SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param CleanMethod cleanMethod: method used to clean pixel with negative values. Accepted values are :py:attr:`~.CleanMethod.ZERO` or :py:attr:`~.CleanMethod.MIN`.</span>
<span class="sd">        :param texpFac: exposure factor used to divide the exposure time when computing Poisson noise. A value of :python:`0` means no Poisson noise is added to the variance map.</span>
<span class="sd">        :type texpFac: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: (columns, column names and column types)</span>
<span class="sd">        :rtype: (:python:`list[int/float/str], list[str], list[Any]`)</span>
<span class="sd">        &#39;&#39;&#39;</span>
       
        <span class="n">data</span>               <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var</span>                <span class="o">=</span> <span class="p">[]</span>
       
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>

            <span class="c1"># Clean and add noise to variance map</span>
            <span class="n">d</span><span class="p">,</span> <span class="n">v</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanAndNoise</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> 
                                                <span class="n">cleanMethod</span> <span class="o">=</span> <span class="n">cleanMethod</span><span class="p">,</span> 
                                                <span class="n">texp</span>        <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">texp</span><span class="p">,</span> 
                                                <span class="n">texpFac</span>     <span class="o">=</span> <span class="n">texpFac</span><span class="p">,</span>
                                                <span class="n">verbose</span>     <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">verbose</span>
                                               <span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">v</span><span class="p">)</span>
        
        <span class="c1"># Go to 1D version</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arraysTo1D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Compute std and convert std and data to mJy unit</span>
        <span class="n">dataList</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stdList</span>            <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">filt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
            
            <span class="n">d</span><span class="p">,</span> <span class="n">err</span>         <span class="o">=</span> <span class="n">countToFlux</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">filt</span><span class="o">.</span><span class="n">zpt</span><span class="p">)</span>
            
            <span class="c1"># Append data and std to list</span>
            <span class="n">dataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>  <span class="s1">&#39;mJy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">stdList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">err</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;mJy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            
        <span class="c1"># Redshift column</span>
        <span class="n">ll</span>                 <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">ld</span>                 <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">zs</span>                 <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">redshift</span><span class="p">]</span><span class="o">*</span><span class="n">ld</span>
        
        <span class="n">dtypes</span>             <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>       <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">ll</span>
        <span class="n">colnames</span>           <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">filter</span><span class="si">}</span><span class="s1">_err&#39;</span><span class="p">]]</span>
        <span class="n">columns</span>            <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="n">zs</span><span class="p">]</span>      <span class="o">+</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataList</span><span class="p">,</span> <span class="n">stdList</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="n">columns</span><span class="p">,</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">dtypes</span></div>
        
    
<div class="viewcode-block" id="FilterList.genTable"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.genTable">[docs]</a>    <span class="k">def</span> <span class="nf">genTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanMethod</span><span class="p">:</span> <span class="n">CleanMethod</span> <span class="o">=</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">texpFac</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate an input table for the SED fitting codes.</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param CleanMethod cleanMethod: method used to clean pixel with negative values. Accepted values are :py:attr:`~.CleanMethod.ZERO` or :py:attr:`~.CleanMethod.MIN`.</span>
<span class="sd">        :param scaleFactor: factor used to multiply data and std map. Only used if SED fitting code is LePhare.</span>
<span class="sd">        :type scaleFactor: :python:`int` or :python:`float`</span>
<span class="sd">        :param texpFac: exposure factor used to divide the exposure time when computing Poisson noise. A value of :python:`0` means no Poisson noise is added to the variance map.</span>
<span class="sd">        :type texpFac: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: an output table</span>
<span class="sd">        :rtype: `Astropy Table`_</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if there are no filters in the filter list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;At least one filter must be in the filter list to build a table.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">LEPHARE</span><span class="p">:</span>
            <span class="n">col</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LePhareTableFactory</span><span class="p">(</span><span class="n">cleanMethod</span><span class="o">=</span><span class="n">cleanMethod</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="o">=</span><span class="n">scaleFactor</span><span class="p">,</span> <span class="n">texpFac</span><span class="o">=</span><span class="n">texpFac</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="ow">is</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">CIGALE</span><span class="p">:</span>
            <span class="n">col</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CigaleTableFactory</span><span class="p">(</span><span class="n">cleanMethod</span><span class="o">=</span><span class="n">cleanMethod</span><span class="p">,</span> <span class="n">texpFac</span><span class="o">=</span><span class="n">texpFac</span><span class="p">)</span>
            
        <span class="c1"># Generate the output Table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span>             <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span></div>
     
        
    <span class="c1">#############################</span>
    <span class="c1">#       Data handling       #</span>
    <span class="c1">#############################</span>
    
<div class="viewcode-block" id="FilterList.arraysTo1D"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.arraysTo1D">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">arraysTo1D</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">var</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">indices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Convert list of data and variance maps into 1D vectors and remove nan values.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Provide :python:`indices = True` to get the indices of the non-NaN pixels in the 1D array (before NaN values are removed).</span>
<span class="sd">            </span>
<span class="sd">        :param data: data map</span>
<span class="sd">        :type data: `ndarray`_</span>
<span class="sd">        :param var: variance map</span>
<span class="sd">        :type var: `ndarray`_</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param indices: whether to return the list of indices of non-NaN values or not</span>
<span class="sd">        :type indices: :python:`bool`</span>
<span class="sd">        </span>
<span class="sd">        :returns: (1D data, 1D variance (and the indices if **indices** is :python:`True`))</span>
<span class="sd">        :rtype: (`ndarray`_, `ndarray`_) or (`ndarray`_, `ndarray`_, `ndarray`_ [:python:`int`])</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError:</span>
<span class="sd">            </span>
<span class="sd">            * if **data** or **var** are not :python:`list`</span>
<span class="sd">            * if one element of **data** or **var** is not a `ndarray`_</span>
<span class="sd">            * if **indices** is not a :python:`bool`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list of numpy.ndarray.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;var has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list of numpy.ndarray.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;One element of data is not a numpy.ndarray.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;One element of var is not a numpy.ndarray.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;indices parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must of type bool.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Avoid to overwrite original arrays</span>
        <span class="n">data</span>        <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">var</span>         <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        
        <span class="n">length</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
        <span class="c1"># Transform data and error maps into 1D vectors</span>
        <span class="n">data</span>        <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">var</span>         <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span> <span class="p">]</span>
        
        <span class="c1"># Compute mask of non-NaN values that is the intersection of the masks in all the bands</span>
        <span class="n">nanMask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
            <span class="n">nanMask</span> <span class="o">=</span> <span class="n">nanMask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            
        <span class="n">data</span>        <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">nanMask</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">var</span>         <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="n">nanMask</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var</span> <span class="p">]</span>
        
        <span class="k">if</span> <span class="n">indices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nanMask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">var</span></div>
    
<div class="viewcode-block" id="FilterList.clean"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.clean">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">var</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">CleanMethod</span> <span class="o">=</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Clean given data and error maps by masking pixels and dealing with negative values.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">                </span>
<span class="sd">            * If **method** is :py:attr:`~.CleanMethod.ZERO`, negative values in the data and error maps are set to 0</span>
<span class="sd">            * If **method** is :py:attr:`~.CleanMethod.MIN`, negative values in the data and error maps are set to the minimum value in the array</span>
<span class="sd">            </span>
<span class="sd">        :param data: data map</span>
<span class="sd">        :type data: `ndarray`_</span>
<span class="sd">        :param var: variance map</span>
<span class="sd">        :type var: `ndarray`_</span>
<span class="sd">        :param mask: mask used to apply NaN values</span>
<span class="sd">        :type mask: `ndarray`_ [:python:`bool`]</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param CleanMethod method: method to deal with negative values. Possible values are: :py:attr:`~.CleanMethod.ZERO` or :py:attr:`~.CleanMethod.MIN`.</span>
<span class="sd">        </span>
<span class="sd">        :returns: cleaned data and variance maps</span>
<span class="sd">        :rtype: (`ndarray`_, `ndarray`_)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">CleanMethod</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;method parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type CleanMethod.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Deep copies to avoid to overwrite input arrays</span>
        <span class="n">data</span>              <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">var</span>               <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        
        <span class="c1"># Apply mask</span>
        <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">var</span><span class="p">[</span> <span class="n">mask</span><span class="p">]</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        
        <span class="c1"># Mask pixels having negative values</span>
        <span class="n">negMask</span>           <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">var</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">negMask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">var</span><span class="p">[</span> <span class="n">negMask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">MIN</span><span class="p">:</span>
            <span class="n">mini</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">negMask</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="n">negMask</span><span class="p">]</span> <span class="o">=</span> <span class="n">mini</span>
            <span class="n">var</span><span class="p">[</span> <span class="n">negMask</span><span class="p">]</span> <span class="o">=</span> <span class="n">mini</span>
            
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">var</span></div>
    
<div class="viewcode-block" id="FilterList.cleanAndNoise"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.cleanAndNoise">[docs]</a>    <span class="k">def</span> <span class="nf">cleanAndNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> 
                      <span class="n">cleanMethod</span><span class="p">:</span> <span class="n">CleanMethod</span>                 <span class="o">=</span> <span class="n">CleanMethod</span><span class="o">.</span><span class="n">ZERO</span><span class="p">,</span> 
                      <span class="n">texp</span>       <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                      <span class="n">texpFac</span>    <span class="p">:</span> <span class="nb">int</span>                         <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">verbose</span>    <span class="p">:</span> <span class="nb">bool</span>                        <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Clean data and variance maps from bad pixels and add Poisson noise to the variance map.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            If **texpFac** is :python:`0` or **texp** is :python:`None`, no Poisson noise is added to the variance map</span>
<span class="sd">            </span>
<span class="sd">        :param data: data map</span>
<span class="sd">        :type data: `ndarray`_</span>
<span class="sd">        :param data2: data map convolved by the square of the PSF used to add Poisson noise</span>
<span class="sd">        :type data2: `ndarray`_</span>
<span class="sd">        :param var: variance map</span>
<span class="sd">        :type var: `ndarray`_</span>
<span class="sd">        :param mask: mask map</span>
<span class="sd">        :type mask: `ndarray`_ [:python:`bool`]</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param CleanMethod cleanMethod: method used for the cleaning process</span>
<span class="sd">        :param texp: exposition time</span>
<span class="sd">        :type texp: :python:`int` or :python:`float`</span>
<span class="sd">        :param texpFac: factor used to divide the exposition time</span>
<span class="sd">        :type texpFac: :python:`int`</span>
<span class="sd">        :param verbose: whether to print info text or not</span>
<span class="sd">        :type verbose: :python:`bool`</span>
<span class="sd">        </span>
<span class="sd">        :returns: cleaned data and cleaned variance map (with potentially Poisson noise added)</span>
<span class="sd">        :rtype: (`ndarray`_, `ndarray`_)</span>
<span class="sd">        </span>
<span class="sd">        :raises: TypeError if :python:`not isinstance(verbose, bool)`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;verbose has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it should be a bool.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Clean data and error maps of bad pixels and pixels with negative values</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">cleanMethod</span><span class="p">)</span>
            
        <span class="c1"># Add Poisson noise to the variance map</span>
        <span class="k">if</span> <span class="n">texp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Poisson noise...&#39;</span><span class="p">)</span>
            <span class="n">var</span>  <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poissonVar</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">texp</span><span class="o">=</span><span class="n">texp</span><span class="p">,</span> <span class="n">texpFac</span><span class="o">=</span><span class="n">texpFac</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">var</span></div>
    
<div class="viewcode-block" id="FilterList.computeMeanMap"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.computeMeanMap">[docs]</a>    <span class="k">def</span> <span class="nf">computeMeanMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maskVal</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Compute the averaged data and error maps over the spectral dimension for non masked pixels.</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param maskVal: value to put into masked pixels</span>
<span class="sd">        :type maskVal: :python:`int` or :python:`float`</span>
<span class="sd">        </span>
<span class="sd">        :returns: averaged data and averaged error map</span>
<span class="sd">        :rtype: (`ndarray`_, `ndarray`_)</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **maskVal** is neither :python:`int` nor :python:`float`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maskVal</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;maskVal parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">maskVal</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type int or float.&#39;</span><span class="p">)</span>
            
        <span class="c1"># Compute masked arrays</span>
        <span class="n">data</span>      <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">]</span>
        <span class="n">err</span>       <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">_mask</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">var</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">]</span>
        
        <span class="c1"># Compute mean value along spectral dimension</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
            <span class="n">data</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">err</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">err</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="c1"># Replace NaN values</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">maskVal</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">err</span><span class="p">,</span>  <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">maskVal</span><span class="p">)</span>
        
        <span class="c1"># Store mean data map for easy access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meanMap</span> <span class="o">=</span> <span class="n">data</span>
        
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span></div>
    
<div class="viewcode-block" id="FilterList.poissonVar"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.poissonVar">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">poissonVar</span><span class="p">(</span><span class="n">data2</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">texp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">texpFac</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Compute a scaled Poisson variance term from a given flux map. The variance :math:`(\Delta F)^2` is computed as</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">            </span>
<span class="sd">            (\Delta F)^2 = | \alpha F |,</span>
<span class="sd">        </span>
<span class="sd">        where :math:`F` is the flux map and :math:`\alpha` is a scale factor defined as</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>
<span class="sd">                </span>
<span class="sd">            \alpha = {\rm{TEXP / TEXPFAC}},</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        where :math:`\rm{TEXP}` is the exposure time and :math:`\rm{TEXPFAC}` is a coefficient used to scale it down.</span>
<span class="sd">        </span>
<span class="sd">        :param data2: flux map convolved by the square of the PSF</span>
<span class="sd">        :type data2: `ndarray`_</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param texp: exposure time in seconds</span>
<span class="sd">        :type texp: :python:`int` or :python:`float`</span>
<span class="sd">        :param texpFac: exposure factor</span>
<span class="sd">        :type texpFac: :python:`int` or :python:`float`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **texp** or **texpFac** are not both :python:`int` or :python:`float`</span>
<span class="sd">        :raises ValueError:</span>
<span class="sd">            </span>
<span class="sd">            * if :python:`texp &lt;= 0`</span>
<span class="sd">            * if :python:`texpFac &lt; 0`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">texp</span><span class="p">,</span> <span class="n">texpFac</span><span class="p">]]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;texp and texpFac parameters have types </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">texp</span><span class="p">)</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">texpFac</span><span class="p">)</span><span class="si">}</span><span class="s1"> but they must have type int or float.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">texp</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;texp has value </span><span class="si">{</span><span class="n">texp</span><span class="si">}</span><span class="s1"> but it must be positive.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">texpFac</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;texpFac has value </span><span class="si">{</span><span class="n">texpFac</span><span class="si">}</span><span class="s1"> but it must be positive or null.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span> <span class="o">*</span> <span class="n">texpFac</span> <span class="o">/</span> <span class="n">texp</span></div>
    
<div class="viewcode-block" id="FilterList.scale"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">var</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">norm</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Normalise given data and error maps using a norm map and scale by a certain amount. Necessary for LePhare SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :param data: data map</span>
<span class="sd">        :type data: `ndarray`_</span>
<span class="sd">        :param var: variance map</span>
<span class="sd">        :type var: `ndarray`_</span>
<span class="sd">        :param norm: normalisation map which divides data and error maps</span>
<span class="sd">        :type norm: `ndarray`_</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param factor: scale factor which multiplies the output array</span>
<span class="sd">        :type factor: :python:`int` or :python:`float`</span>
<span class="sd">        </span>
<span class="sd">        :returns: scaled data and variance maps</span>
<span class="sd">        :rtype: (`ndarray`_, `ndarray`_)</span>
<span class="sd">        </span>
<span class="sd">        :raises ValueError: if **data** and **norm** do not have the same shapes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">norm</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Incompatible norm and data shapes. norm map has shape </span><span class="si">{</span><span class="n">norm</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> but data map has shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Deep copies to avoid to overwrite input arrays</span>
        <span class="n">d</span>             <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">v</span>             <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        
        <span class="n">mask</span>          <span class="o">=</span> <span class="n">norm</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">d</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>      <span class="o">*=</span> <span class="n">factor</span><span class="o">/</span><span class="n">norm</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>      <span class="o">*=</span> <span class="p">(</span><span class="n">factor</span><span class="o">*</span><span class="n">factor</span><span class="o">/</span><span class="p">(</span><span class="n">norm</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">norm</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span> <span class="c1"># Variance normalisation is squared</span>
        
        <span class="c1"># Store scale factor for easy access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleFac</span> <span class="o">=</span> <span class="n">factor</span>
        
        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span></div>
        
        
    <span class="c1">####################</span>
    <span class="c1">#       Misc       #</span>
    <span class="c1">####################    </span>
    
<div class="viewcode-block" id="FilterList.setCode"><a class="viewcode-back" href="../../API/filters.html#pixSED.filters.FilterList.setCode">[docs]</a>    <span class="k">def</span> <span class="nf">setCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="n">SEDcode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Set the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>
<span class="sd">            </span>
<span class="sd">            This function also recomputes and rewrites the output table used for the SED fitting.</span>
<span class="sd">            If you want a table with different parameters you must run :py:meth:`~FilterList.genTable` again, for e.g.</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from SED.misc import SEDcode, CleanMethod</span>
<span class="sd">            &gt;&gt;&gt; flist = FilterList(filters, mask)          # setCode and genTable methods are called with default SED fitting code name</span>
<span class="sd">            &gt;&gt;&gt; flist.setCode(SEDcode.LEPHARE,             # setCode and genTable methods are called with &#39;lephare&#39; SED fitting code name</span>
<span class="sd">                              cleanMethod=CleanMethod.MIN, # Additional parameters are passed to genTable</span>
<span class="sd">                              scaleFactor=50)                             </span>
<span class="sd">        </span>
<span class="sd">        :param SEDcode code: code used for SED fitting. Acceptable values are :py:attr:`~.SEDcode.CIGALE` and :py:attr:`~.SEDcode.LEPHARE`.</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **code** is not of type :py:class:`~.SEDcode`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">SEDcode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;code parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be of type SEDcode.&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
            
        <span class="c1"># Update output table with default parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genTable</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span></div>
    
    
    <span class="c1">#############################</span>
    <span class="c1">#      Partial methods      #</span>
    <span class="c1">#############################</span>
    
    <span class="c1">#: Set Cigale as fitting code</span>
    <span class="n">setCigale</span>  <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">setCode</span><span class="p">,</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">CIGALE</span><span class="p">)</span>
    
    <span class="c1">#: Set LePhare as fitting code</span>
    <span class="n">setLePhare</span> <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">setCode</span><span class="p">,</span> <span class="n">SEDcode</span><span class="o">.</span><span class="n">LEPHARE</span><span class="p">)</span></div>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2022-2024, Wilfried Mercier.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>