

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pixSED.sed &#8212; pixSED</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mycss.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pixSED/sed';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Support for LePhare is currently deprecated as it relies on the old Fortran version. Please use Cigale instead.</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/logo1.png" class="logo__image only-light" alt="pixSED documentation - Home"/>
    <script>document.write(`<img src="../../_static/logo1.png" class="logo__image only-dark" alt="pixSED documentation - Home"/>`);</script>
  
  
    <p class="title logo__title">pixSED</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup.html">
                        Installation and setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../nomenclature.html">
                        Nomenclature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../poisson.html">
                        About Poisson noise
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../API/index.html">
                        API
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/WilfriedMercier/SED" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup.html">
                        Installation and setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../nomenclature.html">
                        Nomenclature
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../poisson.html">
                        About Poisson noise
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../examples.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../API/index.html">
                        API
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/WilfriedMercier/SED" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pixSED.sed</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pixSED.sed</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. codeauthor:: Hugo Plombat - LUPM &lt;hugo.plombat@umontpellier.fr&gt; &amp; Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>

<span class="sd">Main SED objects used to perform pixel-per-pixel SED fitting.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>          <span class="k">as</span>     <span class="nn">opath</span>

<span class="kn">from</span>   <span class="nn">distutils.spawn</span>  <span class="kn">import</span> <span class="n">find_executable</span>
<span class="kn">from</span>   <span class="nn">copy</span>             <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span>   <span class="nn">typing</span>           <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span>   <span class="nn">io</span>               <span class="kn">import</span> <span class="n">TextIOBase</span>
<span class="kn">from</span>   <span class="nn">abc</span>              <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span>   <span class="nn">textwrap</span>         <span class="kn">import</span> <span class="n">dedent</span><span class="p">,</span> <span class="n">indent</span>
<span class="kn">from</span>   <span class="nn">functools</span>        <span class="kn">import</span> <span class="n">partialmethod</span>

<span class="kn">from</span>   <span class="nn">.outputs</span>         <span class="kn">import</span> <span class="n">LePhareOutput</span><span class="p">,</span> <span class="n">CigaleOutput</span>
<span class="kn">from</span>   <span class="nn">.catalogues</span>      <span class="kn">import</span> <span class="n">LePhareCat</span><span class="p">,</span> <span class="n">CigaleCat</span>
<span class="kn">from</span>   <span class="nn">.coloredMessages</span> <span class="kn">import</span> <span class="n">errorMessage</span><span class="p">,</span> <span class="n">warningMessage</span>
<span class="kn">from</span>   <span class="nn">.misc.properties</span> <span class="kn">import</span> <span class="n">IntProperty</span><span class="p">,</span> <span class="n">FloatProperty</span><span class="p">,</span> <span class="n">StrProperty</span><span class="p">,</span> <span class="n">ListIntProperty</span><span class="p">,</span> <span class="n">ListFloatProperty</span><span class="p">,</span> <span class="n">ListStrProperty</span><span class="p">,</span> <span class="n">PathProperty</span><span class="p">,</span> <span class="n">ListPathProperty</span><span class="p">,</span> <span class="n">EnumProperty</span><span class="p">,</span> <span class="n">BoolProperty</span>
<span class="kn">from</span>   <span class="nn">.misc.enum</span>       <span class="kn">import</span> <span class="n">MagType</span><span class="p">,</span> <span class="n">YESNO</span><span class="p">,</span> <span class="n">ANDOR</span><span class="p">,</span> <span class="n">LePhareOutputParam</span>
<span class="kn">from</span>   <span class="nn">.misc</span>            <span class="kn">import</span> <span class="n">cigaleModules</span> <span class="k">as</span> <span class="n">cigmod</span>
                         
     
<span class="n">ERROR</span>   <span class="o">=</span> <span class="n">errorMessage</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">)</span>
<span class="n">WARNING</span> <span class="o">=</span> <span class="n">warningMessage</span><span class="p">(</span><span class="s1">&#39;Warning:&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SED"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.SED">[docs]</a><span class="k">class</span> <span class="nc">SED</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">    </span>
<span class="sd">    Abstract SED object used for inheritance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;Init SED oject.&#39;&#39;&#39;</span>
        
        <span class="c1">#: Log file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Run the SED fitting code.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">return</span>
    
<div class="viewcode-block" id="SED.appendLog"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.SED.appendLog">[docs]</a>    <span class="k">def</span> <span class="nf">appendLog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">TextIOBase</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Append a new text line to the log file.</span>
<span class="sd">        </span>
<span class="sd">        :param text: text to append</span>
<span class="sd">        :type text: :python:`str`</span>
<span class="sd">        :param f: file-like opened obect to write into</span>
<span class="sd">        :type f: `TextIOBase`_</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param verbose: whether to also print the log line or not</span>
<span class="sd">        :type verbose: :python:`bool`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError:</span>
<span class="sd">            </span>
<span class="sd">            * if **text** is not of type :python:`str`</span>
<span class="sd">            * if **verbose** is not of type :python:`bool`</span>
<span class="sd">            * if **f** is not of type `TextIOBase`_</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;log text has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;verbose parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type bool.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">TextIOBase</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type TextIOBase.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="SED.startProcess"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.SED.startProcess">[docs]</a>    <span class="k">def</span> <span class="nf">startProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                     <span class="n">commands</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                     <span class="n">log</span>      <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TextIOBase</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">errMsg</span>   <span class="p">:</span> <span class="nb">str</span>                  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>

<span class="sd">        Start a process.</span>
<span class="sd">        </span>
<span class="sd">        :param commands: list of commands to use with Popen</span>
<span class="sd">        :type commands: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param log: oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        :param errMsg: message error to show if the process failed</span>
<span class="sd">        :type errMsg: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: </span>
<span class="sd">            </span>
<span class="sd">            * if **errMsg** is not of type :python:`str`</span>
<span class="sd">            * if **commands** is not of type :python:`list`</span>
<span class="sd">            * if one of the commands in **commands** is not of type :python:`str`</span>
<span class="sd">            </span>
<span class="sd">        :raises OSError: if the first command in **commands** is not a valid file/script name</span>
<span class="sd">        :raises ValueError: if **log** is :python:`None`</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errMsg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;errMsg parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;commands parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;one of the commands does not have the type str.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You need to provide a log file-like object.&#39;</span><span class="p">)</span>
            
        <span class="n">command</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">find_executable</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;script/excutable </span><span class="si">{</span><span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> (expanded as </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s1">) not found.&#39;</span><span class="p">)</span>

        <span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>

        <span class="k">with</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">appendLog</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="n">errMsg</span><span class="p">)</span>
                
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="CigaleSED"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.CigaleSED">[docs]</a><span class="k">class</span> <span class="nc">CigaleSED</span><span class="p">(</span><span class="n">SED</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">    </span>
<span class="sd">    Implements Cigale SED object.</span>
<span class="sd">    </span>
<span class="sd">    .. important:</span>
<span class="sd">        </span>
<span class="sd">        If you want to consider the uncertainties, you must specify it for each band. That is, the following line will not consider uncertainties</span>
<span class="sd">        </span>
<span class="sd">        :python:`sedobj = CigaleSED(&#39;someID&#39;, [&#39;F160W&#39;, &#39;F125W&#39;, &#39;F850LP&#39;])`</span>
<span class="sd">        </span>
<span class="sd">        On the other hand, the follwing line will consider the uncertainties for the first and last filters (F160W and F850LP) only</span>
<span class="sd">        </span>
<span class="sd">        :python:`sedobj = CigaleSED(&#39;someID&#39;, [&#39;F160W&#39;, &#39;F125W&#39;, &#39;F850LP&#39;], uncertainties=[True, False, True])`</span>
<span class="sd">    </span>
<span class="sd">    :param ID: an identifier used to name the output files created during the SED fitting process</span>
<span class="sd">    :param filters: filters to use for the SED fitting</span>
<span class="sd">    :type filters: :python:`list`</span>

<span class="sd">    **Keyword arguments**</span>
<span class="sd">    </span>
<span class="sd">    :param uncertainties: list of bool to specify which uncertainties to use. If provided, it must be same length as **filters**.</span>
<span class="sd">    :type uncertainties: :python:`list[bool]`</span>
<span class="sd">    :param SFH: star formation history modules to use. **At least one module must be given.**</span>
<span class="sd">    :type SFH: :python:`list` [:py:class:`~SED.misc.cigaleModules.SFHmodule`]</span>
<span class="sd">    :param SSP: single stellar population modules to use. **At least one module must be given.**</span>
<span class="sd">    :type SSP: :python:`list` [:py:class:`~SED.misc.cigaleModules.SSPmodule`]</span>
<span class="sd">    :param nebular: nebular emission modules to use. Empty list means no module is used.</span>
<span class="sd">    :type nebular: :python:`list` [:py:class:`~SED.misc.cigaleModules.NEBULARmodule`]</span>
<span class="sd">    :param attenuation: dust attenuation modules to use. Empty list means no module is used.</span>
<span class="sd">    :type attenuation: :python:`list` [:py:class:`~SED.misc.cigaleModules.ATTENUATIONmodule`]</span>
<span class="sd">    :param dust: dust emission modules to use. Empty list means no module is used.</span>
<span class="sd">    :type dust: :python:`list` [:py:class:`~SED.misc.cigaleModules.DUSTmodule`]</span>
<span class="sd">    :param agn: agn modules to use. Empty list means no module is used.</span>
<span class="sd">    :type agn: :python:`list` [:py:class:`~SED.misc.cigaleModules.AGNmodule`]</span>
<span class="sd">    :param radio: synchrotron radiation modules to use. Empty list means no module is used.</span>
<span class="sd">    :type radio: :python:`list` [:py:class:`SED.misc.cigaleModules.RADIOmodule`]</span>
<span class="sd">    :param restframe: restframe parameters modules to use. Empty list means no module is used.</span>
<span class="sd">    :type restframe: :python:`list` [:py:class:`SED.misc.cigaleModules.RESTFRAMEmodule`]</span>
<span class="sd">    :param redshifting: redshifitng+IGM modules to use. Empty list means no module is used.</span>
<span class="sd">    :type redshifting: :python:`list` [:py:class:`SED.misc.cigaleModules.REDSHIFTINGmodule`]</span>
<span class="sd">    :param flux_uncertainty: additional uncertainty to add to the flux, given as a fraction of the flux (i.e. 0.1 means 10% of flux added to the uncertainty in quadrature)</span>
<span class="sd">    :type flux_uncertainty: :python:`int` or :python:`float`</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if any of the keyword parameters if not a :python:`list`</span>
<span class="sd">    :raises ValueError: if no **SFH**, **SSP** and **redshifting** modules are provided</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                 <span class="n">uncertainties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>         <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">SFH</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SFH2EXPmodule</span><span class="p">()],</span>
                 <span class="n">SSP</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">BC03module</span><span class="p">()],</span>
                 <span class="n">nebular</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span><span class="p">]</span>         <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">attenuation</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">dust</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span><span class="p">]</span>               <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">agn</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span><span class="p">]</span>                 <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">radio</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span><span class="p">]</span>             <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">restframe</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">redshifting</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">()],</span>
                 <span class="n">flux_uncertainty</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>         <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter filters has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list.&#39;</span><span class="p">)</span>
        
        <span class="c1"># If no uncertainty is given, we do not use the filters</span>
        <span class="k">if</span> <span class="n">uncertainties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">SFH</span><span class="p">,</span> <span class="n">SSP</span><span class="p">,</span> <span class="n">nebular</span><span class="p">,</span> <span class="n">attenuation</span><span class="p">,</span> <span class="n">dust</span><span class="p">,</span> <span class="n">agn</span><span class="p">,</span> <span class="n">radio</span><span class="p">,</span> <span class="n">restframe</span><span class="p">,</span> <span class="n">redshifting</span><span class="p">],</span> 
                             <span class="p">[</span><span class="s1">&#39;uncertainties&#39;</span><span class="p">,</span><span class="s1">&#39;SFH&#39;</span><span class="p">,</span> <span class="s1">&#39;SSP&#39;</span><span class="p">,</span> <span class="s1">&#39;nebular&#39;</span><span class="p">,</span> <span class="s1">&#39;attenuation&#39;</span><span class="p">,</span> <span class="s1">&#39;dust&#39;</span><span class="p">,</span> <span class="s1">&#39;agn&#39;</span><span class="p">,</span> <span class="s1">&#39;radio&#39;</span><span class="p">,</span> <span class="s1">&#39;restframe&#39;</span><span class="p">,</span> <span class="s1">&#39;redshifting&#39;</span><span class="p">]):</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;parameter </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a list.&#39;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;uncertainties has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">)</span><span class="si">}</span><span class="s1"> and filters has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="si">}</span><span class="s1"> but they must have the same length.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;one of the values in uncertainties is not a bool.&#39;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SFH</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;at least one SFH module must be provided.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SSP</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;at least one SSP module must be provided.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">redshifting</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;at least one redshifting module must be provided.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flux_uncertainty</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;flux uncertainty has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">flux_uncertainty</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type int or float.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">flux_uncertainty</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;flux uncertainty must be positive.&#39;</span><span class="p">)</span>
            
            
        <span class="c1">#: Will be used to generate a custom directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">Any</span>                               <span class="o">=</span> <span class="n">ID</span>
        
        <span class="c1"># Flux uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux_uncertainty</span>                      <span class="o">=</span> <span class="n">flux_uncertainty</span>
        
        <span class="c1">#: Filters to use for the SED fitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span> <span class="n">ListStrProperty</span>              <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">filters</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filt</span><span class="si">}</span><span class="s1">_err&#39;</span> <span class="k">for</span> <span class="n">filt</span><span class="p">,</span> <span class="n">uncertainty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">uncertainties</span><span class="p">)</span> <span class="k">if</span> <span class="n">uncertainty</span><span class="p">])</span>
        
        <span class="c1"># For now we set this parameter to an empty str and we only allow pdf_analysis method (no savefluxes)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>                              <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;pdf_analysis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_file</span>                       <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span>                            <span class="o">=</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#: SFH modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SFH</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">SFH</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SFHmodule</span><span class="p">)</span> 
        
        <span class="c1">#: SSP modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">SSP</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">SSPmodule</span><span class="p">)</span>
        
        <span class="c1">#: Nebular emission modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">nebular</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">NEBULARmodule</span><span class="p">)</span>
        
        <span class="c1">#: Dust attenuation modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">attenuation</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">ATTENUATIONmodule</span><span class="p">)</span>
        
        <span class="c1">#: Dust emission modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dust</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">dust</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">DUSTmodule</span><span class="p">)</span>
        
        <span class="c1">#: AGN modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agn</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">agn</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">AGNmodule</span><span class="p">)</span>
        
        <span class="c1">#: Synchrotron radiation modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">radio</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RADIOmodule</span><span class="p">)</span>
        
        <span class="c1">#: Rest-frame parameters modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">restframe</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">RESTFRAMEmodule</span><span class="p">)</span>
        
        <span class="c1">#: Redshifting modules to use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">:</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkModule</span><span class="p">(</span><span class="n">redshifting</span><span class="p">,</span> <span class="n">cigmod</span><span class="o">.</span><span class="n">REDSHIFTmodule</span><span class="p">)</span>
        
        <span class="c1">#: Modules names list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moduleNames</span><span class="p">:</span> <span class="n">ListStrProperty</span>           <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SFH</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">agn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">])</span>
        
        <span class="c1">#: Modules parameters in str format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span><span class="p">:</span> <span class="nb">str</span>                        <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1">#: Modules spec parameters in str format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span><span class="p">:</span> <span class="nb">str</span>                       <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SFH</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SSP</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nebular</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">attenuation</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dust</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">agn</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">restframe</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">redshifting</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span>                        <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span>                       <span class="o">+=</span> <span class="n">indent</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="n">spec</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;   &#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CigaleSED._checkModule"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.CigaleSED._checkModule">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_checkModule</span><span class="p">(</span><span class="n">modules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">inheritedClass</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Check that the given list of Cigale modules belong to the correct class they should inherit from.</span>
<span class="sd">        </span>
<span class="sd">        :param modules: modules to check the inheritance</span>
<span class="sd">        :type modules: :python:`list`</span>
<span class="sd">        :param inheritedClass: class to check against for inheritance</span>
<span class="sd">        </span>
<span class="sd">        :returns: the list of modules if all the modules inherit from the given class</span>
<span class="sd">        :rtype: :python:`list`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if one of the modules in **modules** does not inherit from **inheritedClass**</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">inheritedClass</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;module </span><span class="si">{</span><span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> is not an instance of a subclass of </span><span class="si">{</span><span class="n">inheritedClass</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">modules</span></div>
    
    <span class="c1">###############################</span>
    <span class="c1">#       Text formatting       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="CigaleSED.analysisParamsModule"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.CigaleSED.analysisParamsModule">[docs]</a>    <span class="k">def</span> <span class="nf">analysisParamsModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">physical_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">save_best_sed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                             <span class="n">save_chi2</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">lim_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mock_flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">redshift_decimals</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate the analysis_params module text for Cigale.</span>
<span class="sd">        </span>
<span class="sd">        :param physical_properties: physical properties to estimate at the end of the SED fitting. If :python:`None`, all properties are computed.</span>
<span class="sd">        :type physical_properties: :python:`list[str]`</span>
<span class="sd">        :param bands: list of bands for which to estimate the fluxes. Note that this is independent from the fluxes actually fitted to estimate the physical properties. If :python:`None`, the same bands as the ones provided in **filters** will be used.</span>
<span class="sd">        :type bands: :python:`list[str]`</span>
<span class="sd">        :param save_best_sed: whether to save the best SED for each observation into a file or not</span>
<span class="sd">        :type save_best_sed: :python:`bool`</span>
<span class="sd">        :param save_chi2: whether to save the raw chi2 or not. It occupies ~15 MB/million models/variable.</span>
<span class="sd">        :type save_chi2: :python:`bool`</span>
<span class="sd">        :param lim_flag: if :python:`True`, for each object check whether upper limits are present and analyse them</span>
<span class="sd">        :type lim_flag: :python:`bool`</span>
<span class="sd">        :param mock_flag: if :python:`True`, for each object we create a mock object and analyse them</span>
<span class="sd">        :type bool_mock: :python:`bool`</span>
<span class="sd">        :param redshift_decimals: when redshifts are not given explicitly in the redshifting module, number of decimals to round the observed redshifts to compute the grid of models. To disable rounding give :python:`-1`. Do not round if you use narrow-band filters.</span>
<span class="sd">        :type redshift_decimals: :python:`int`</span>
<span class="sd">        :param int blocks: number of blocks to compute the models and analyse the observations. If there is enough memory, we strongly recommend this to be set to :python:`1`.</span>
<span class="sd">        :type blocks: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: module text for the analysis parameters</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        # Configuration of the statistical analysis method.</span>
<span class="s1">        [analysis_params]</span>
<span class="s1">          # List of the physical properties to estimate. Leave empty to analyse</span>
<span class="s1">          # all the physical properties (not recommended when there are many</span>
<span class="s1">          # models).</span>
<span class="s1">          variables = </span><span class="si">{</span><span class="n">physical_properties</span><span class="si">}</span>
<span class="s1">          # List of bands for which to estimate the fluxes. Note that this is</span>
<span class="s1">          # independent from the fluxes actually fitted to estimate the physical</span>
<span class="s1">          # properties.</span>
<span class="s1">          bands = </span><span class="si">{</span><span class="n">bands</span><span class="si">}</span>
<span class="s1">          # If true, save the best SED for each observation to a file.</span>
<span class="s1">          save_best_sed = </span><span class="si">{</span><span class="n">save_best_sed</span><span class="si">}</span>
<span class="s1">          # If true, for each observation and each analysed property, save the raw</span>
<span class="s1">          # chi2. It occupies ~15 MB/million models/variable.</span>
<span class="s1">          save_chi2 = </span><span class="si">{</span><span class="n">save_chi2</span><span class="si">}</span>
<span class="s1">          # If true, for each object check whether upper limits are present and</span>
<span class="s1">          # analyse them.</span>
<span class="s1">          lim_flag = </span><span class="si">{</span><span class="n">lim_flag</span><span class="si">}</span>
<span class="s1">          # If true, for each object we create a mock object and analyse them.</span>
<span class="s1">          mock_flag = </span><span class="si">{</span><span class="n">mock_flag</span><span class="si">}</span>
<span class="s1">          # When redshifts are not given explicitly in the redshifting module,</span>
<span class="s1">          # number of decimals to round the observed redshifts to compute the grid</span>
<span class="s1">          # of models. To disable rounding give a negative value. Do not round if</span>
<span class="s1">          # you use narrow-band filters.</span>
<span class="s1">          redshift_decimals = </span><span class="si">{</span><span class="n">redshift_decimals</span><span class="si">}</span>
<span class="s1">          # Number of blocks to compute the models and analyse the observations.</span>
<span class="s1">          # If there is enough memory, we strongly recommend this to be set to 1.</span>
<span class="s1">          blocks = </span><span class="si">{</span><span class="n">blocks</span><span class="si">}</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate a parameter file text used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :returns: the text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># %INPUTCATALOGUEINFORMATION% and %NCORES% are replaced when the run method is launched</span>
        
        <span class="n">text1</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">        # File containing the input data. The columns are &#39;id&#39; (name of the</span>
<span class="s1">        # object), &#39;redshift&#39; (if 0 the distance is assumed to be 10 pc),</span>
<span class="s1">        # &#39;distance&#39; (Mpc, optional, if present it will be used in lieu of the</span>
<span class="s1">        # distance computed from the redshift), the filter names for the fluxes,</span>
<span class="s1">        # and the filter names with the &#39;_err&#39; suffix for the uncertainties. The</span>
<span class="s1">        # fluxes and the uncertainties must be in mJy for broadband data and in</span>
<span class="s1">        # W/m² for emission lines. This file is optional to generate the</span>
<span class="s1">        # configuration file, in particular for the savefluxes module.</span>
<span class="s1">        data_file = %INPUTCATALOGUEINFORMATION%</span>
<span class="s1">        </span>
<span class="s1">        # Optional file containing the list of physical parameters. Each column</span>
<span class="s1">        # must be in the form module_name.parameter_name, with each line being a</span>
<span class="s1">        # different model. The columns must be in the order the modules will be</span>
<span class="s1">        # called. The redshift column must be the last one. Finally, if this</span>
<span class="s1">        # parameter is not empty, cigale will not interpret the configuration</span>
<span class="s1">        # parameters given in pcigale.ini. They will be given only for</span>
<span class="s1">        # information. Note that this module should only be used in conjonction</span>
<span class="s1">        # with the savefluxes module. Using it with the pdf_analysis module will</span>
<span class="s1">        # yield incorrect results.</span>
<span class="s1">        parameters_file = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters_file</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Avaiable modules to compute the models. The order must be kept.</span>
<span class="s1">        # SFH:</span>
<span class="s1">        # * sfh2exp (double exponential)</span>
<span class="s1">        # * sfhdelayed (delayed SFH with optional exponential burst)</span>
<span class="s1">        # * sfhdelayedbq (delayed SFH with optional constant burst/quench)</span>
<span class="s1">        # * sfhfromfile (arbitrary SFH read from an input file)</span>
<span class="s1">        # * sfhperiodic (periodic SFH, exponential, rectangle or delayed)</span>
<span class="s1">        # SSP:</span>
<span class="s1">        # * bc03 (Bruzual and Charlot 2003)</span>
<span class="s1">        # * m2005 (Maraston 2005; note that it cannot be combined with the nebular module)</span>
<span class="s1">        # Nebular emission:</span>
<span class="s1">        # * nebular (continuum and line nebular emission)</span>
<span class="s1">        # Dust attenuation:</span>
<span class="s1">        # * dustatt_modified_CF00 (modified Charlot &amp; Fall 2000 attenuation law)</span>
<span class="s1">        # * dustatt_modified_starburst (modified Calzetti 2000 attenuaton law)</span>
<span class="s1">        # Dust emission:</span>
<span class="s1">        # * casey2012 (Casey 2012 dust emission models)</span>
<span class="s1">        # * dale2014 (Dale et al. 2014 dust emission templates)</span>
<span class="s1">        # * dl2007 (Draine &amp; Li 2007 dust emission models)</span>
<span class="s1">        # * dl2014 (Draine et al. 2014 update of the previous models)</span>
<span class="s1">        # * themis (Themis dust emission models from Jones et al. 2017)</span>
<span class="s1">        # AGN:</span>
<span class="s1">        # * fritz2006 (AGN models from Fritz et al. 2006)</span>
<span class="s1">        # Radio:</span>
<span class="s1">        # * radio (synchrotron emission)</span>
<span class="s1">        # Restframe parameters:</span>
<span class="s1">        # * restframe_parameters (UV slope (β), IRX, D4000, EW, etc.)</span>
<span class="s1">        # Redshift+IGM:</span>
<span class="s1">        # * redshifting (mandatory, also includes the IGM from Meiksin 2006)</span>
<span class="s1">        sed_modules = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">moduleNames</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Method used for statistical analysis. Available methods: pdf_analysis,</span>
<span class="s1">        # savefluxes.</span>
<span class="s1">        analysis_method = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Number of CPU cores available. This computer has 8 cores.</span>
<span class="s1">        cores = %NCORES%</span>
<span class="s1">        </span>
<span class="s1">        # Bands to consider. To consider uncertainties too, the name of the band</span>
<span class="s1">        # must be indicated with the _err suffix. For instance: FUV, FUV_err.</span>
<span class="s1">        bands = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Properties to be considered. All properties are to be given in the</span>
<span class="s1">        # rest frame rather than the observed frame. This is the case for</span>
<span class="s1">        # instance the equivalent widths and for luminosity densities.</span>
<span class="s1">        properties = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Relative error added in quadrature to the uncertainties of the fluxes</span>
<span class="s1">        # and the extensive properties.</span>
<span class="s1">        additionalerror = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_uncertainty</span><span class="si">}</span>
<span class="s1">        </span>
<span class="s1">        # Configuration of the SED creation modules.</span>
<span class="s1">        [sed_modules_params]</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        
        <span class="n">text2</span> <span class="o">=</span> <span class="n">indent</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modulesStr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="s1">&#39;   &#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text1</span> <span class="o">+</span> <span class="n">text2</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">specParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate the spec parameter file text associated to the given sed modules.</span>
<span class="sd">        </span>
<span class="sd">        :returns: spec parameter file text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">        data_file = string()</span>
<span class="s1">        parameters_file = string()</span>
<span class="s1">        sed_modules = cigale_string_list()</span>
<span class="s1">        analysis_method = string()</span>
<span class="s1">        cores = integer(min=1)</span>
<span class="s1">        bands = cigale_string_list()</span>
<span class="s1">        properties = cigale_string_list()</span>
<span class="s1">        additionalerror = float()</span>
<span class="s1">        [sed_modules_params]</span>
<span class="s1">        %MODULESSPEC%</span>
<span class="s1">        [analysis_params]</span>
<span class="s1">          variables = cigale_string_list()</span>
<span class="s1">          save_best_sed = boolean()</span>
<span class="s1">          save_chi2 = boolean()</span>
<span class="s1">          lim_flag = boolean()</span>
<span class="s1">          mock_flag = boolean()</span>
<span class="s1">          redshift_decimals = integer()</span>
<span class="s1">          blocks = integer(min=1)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%MODULESSPEC%&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modulesSpec</span><span class="p">)</span>
    
    <span class="c1">#############################</span>
    <span class="c1">#        Run methods        #</span>
    <span class="c1">#############################</span>
    
<div class="viewcode-block" id="CigaleSED.startCigale"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.CigaleSED.startCigale">[docs]</a>    <span class="k">def</span> <span class="nf">startCigale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TextIOBase</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Wrapper around default :py:meth:`SED.startProcess` which allows to run Cigale.</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param log: oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">([</span><span class="s1">&#39;pcigale&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;SED fitting failed.&#39;</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalogue</span><span class="p">:</span> <span class="n">CigaleCat</span><span class="p">,</span> 
                 <span class="n">ncores</span><span class="p">:</span> <span class="nb">int</span>                              <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">physical_properties</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">bands</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>               <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">save_best_sed</span><span class="p">:</span> <span class="nb">bool</span>                      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">save_chi2</span><span class="p">:</span> <span class="nb">bool</span>                          <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">lim_flag</span><span class="p">:</span> <span class="nb">bool</span>                           <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">mock_flag</span><span class="p">:</span> <span class="nb">bool</span>                          <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">redshift_decimals</span><span class="p">:</span> <span class="nb">int</span>                   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="n">blocks</span><span class="p">:</span> <span class="nb">int</span>                              <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CigaleOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Start the SED fitting on the given data using the built-in SED fitting parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param CigaleCat catalogue: catalogue to use for the SED-fitting</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param ncores: number of cores (technically threads) to use to generate the grid of parameters</span>
<span class="sd">        :type ncores: :python:`int`</span>
<span class="sd">        :param physical_properties: physical properties to estimate at the end of the SED fitting. If :python:`None`, all properties are computed.</span>
<span class="sd">        :type physical_properties: :python:`list[str]`</span>
<span class="sd">        :param bands: list of bands for which to estimate the fluxes. Note that this is independent from the fluxes actually fitted to estimate the physical properties. If :python:`None`, the same bands as the ones provided in **filters** will be used.</span>
<span class="sd">        :type bands: :python:`list[str]`</span>
<span class="sd">        :param save_best_sed: whether to save the best SED for each observation into a file or not</span>
<span class="sd">        :type save_best_sed: :python:`bool`</span>
<span class="sd">        :param save_chi2: whether to save the raw chi2 or not. It occupies ~15 MB/million models/variable.</span>
<span class="sd">        :type save_chi2: :python:`bool`</span>
<span class="sd">        :param lim_flag: if :python:`True`, for each object check whether upper limits are present and analyse them</span>
<span class="sd">        :type lim_flag: :python:`bool`</span>
<span class="sd">        :param mock_flag: if :python:`True`, for each object we create a mock object and analyse them</span>
<span class="sd">        :type mock_flag: :python:`bool`</span>
<span class="sd">        :param redshift_decimals: when redshifts are not given explicitly in the redshifting module, number of decimals to round the observed redshifts to compute the grid of models. To disable rounding give :python:`-1`. Do not round if you use narrow-band filters.</span>
<span class="sd">        :type redshift_decimals: :python:`int`</span>
<span class="sd">        :param blocks: number of blocks to compute the models and analyse the observations. If there is enough memory, we strongly recommend this to be set to :python:`1`.</span>
<span class="sd">        :type blocks: :python:`int`</span>
<span class="sd">        </span>
<span class="sd">        :returns: Cigale output file object with data from the loaded file</span>
<span class="sd">        :rtype: CigaleOutput</span>
<span class="sd">    </span>
<span class="sd">        :raises TypeError: if **catalogue** is not of type :py:class:`~.LePhareCat`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">catalogue</span><span class="p">,</span> <span class="n">CigaleCat</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;catalogue has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">catalogue</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a CigaleCat instance.&#39;</span><span class="p">)</span>
            
        <span class="c1"># Check parameters</span>
        <span class="n">ncores</span>            <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">ncores</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">phys_prop</span>         <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">physical_properties</span> <span class="k">if</span> <span class="n">physical_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="n">bands</span>             <span class="o">=</span> <span class="n">ListStrProperty</span><span class="p">(</span><span class="n">bands</span> <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">save_best_sed</span>     <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">save_best_sed</span><span class="p">)</span>
        <span class="n">save_chi2</span>         <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">save_chi2</span><span class="p">)</span>
        <span class="n">lim_flag</span>          <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">lim_flag</span><span class="p">)</span>
        <span class="n">mock_flag</span>         <span class="o">=</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">mock_flag</span><span class="p">)</span>
        <span class="n">redshift_decimals</span> <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">redshift_decimals</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">blocks</span>            <span class="o">=</span> <span class="n">IntProperty</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Make output directory</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
        <span class="c1"># Delete output directory in the galaxy directory if already present (otherwise Cigale will make a new one with a different name)</span>
        <span class="n">outDir</span>    <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;out&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outDir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">outDir</span><span class="p">)</span>
        
        <span class="c1"># Param file in cigale works in a weird way, better to always use the default name (pcigale.ini and pcigale.ini.spec)</span>
        <span class="n">paramFile</span> <span class="o">=</span> <span class="s1">&#39;pcigale.ini&#39;</span>
        <span class="n">pfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">paramFile</span><span class="p">)</span>
        <span class="n">sfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;pcigale.ini.spec&#39;</span><span class="p">)</span>
        <span class="n">logFile</span>   <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.mag&#39;</span><span class="p">,</span> <span class="s1">&#39;_cig.log&#39;</span><span class="p">))</span>
        <span class="n">oCatFile</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span>    <span class="s1">&#39;results.fits&#39;</span><span class="p">)</span>
        
        <span class="c1"># Generate and write parameters file</span>
        <span class="n">beg_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%INPUTCATALOGUEINFORMATION%&#39;</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%NCORES%&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">end_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysisParamsModule</span><span class="p">(</span><span class="n">phys_prop</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">save_best_sed</span><span class="p">,</span> <span class="n">save_chi2</span><span class="p">,</span> <span class="n">lim_flag</span><span class="p">,</span> <span class="n">mock_flag</span><span class="p">,</span> <span class="n">redshift_decimals</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">beg_param</span> <span class="o">+</span> <span class="n">end_param</span><span class="p">)</span> 
            
        <span class="c1"># Generate and write spec file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specParameters</span><span class="p">)</span>
        
        <span class="c1"># Write catalogue</span>
        <span class="n">catalogue</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logFile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>
            
            <span class="c1">###################################</span>
            <span class="c1">#         Run SED fitting         #</span>
            <span class="c1">###################################</span>
            
            <span class="c1"># Move to directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">startCigale</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1"># Move back to parent directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">CigaleOutput</span><span class="p">(</span><span class="n">oCatFile</span><span class="p">)</span> </div>
                

<div class="viewcode-block" id="LePhareSED"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.LePhareSED">[docs]</a><span class="k">class</span> <span class="nc">LePhareSED</span><span class="p">(</span><span class="n">SED</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">    </span>
<span class="sd">    Implements LePhare SED object.</span>
<span class="sd">    </span>
<span class="sd">    .. important::</span>
<span class="sd">        </span>
<span class="sd">        It is mandatory to define on your OS two environment variables:</span>
<span class="sd">        </span>
<span class="sd">        * :file:`$LEPHAREWORK` which points to LePhare working directory</span>
<span class="sd">        * :file:`$LEPHAREDIR` which points to LePhare main directory</span>
<span class="sd">            </span>
<span class="sd">        These paths may be expanded to check whether the given files exist and can be used by the user to shorten some path names when providing the SED properties.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    :param ID: an identifier used to name the output files created during the SED fitting process</span>
<span class="sd">    </span>
<span class="sd">    **Keyword arguments**</span>
<span class="sd">    </span>
<span class="sd">    :param properties: properties to be passed to LePhare to compute the models grid and perform the SED fitting</span>
<span class="sd">    :type properties: :python:`dict[str, str]`</span>
<span class="sd">    </span>
<span class="sd">    :raises TypeError: if one of the properties keys is not of type :python:`str`</span>
<span class="sd">    :raises ValueError: if one of the properties does not have a valid name (see list below)</span>
<span class="sd">    </span>
<span class="sd">    **Accepted properties are:**</span>

<span class="sd">    * **STAR_SED** [:python:`str`]: stellar library list file (full path)</span>
<span class="sd">    * **STAR_FSCALE** [:python:`float`]: stellar flux scale</span>
<span class="sd">    * **STAR_LIB** [:python:`str`]: stellar library to use (default libraries found at :file:`$LEPHAREWORK/lib_bin`). To not use a stellar library, provide :python:`&#39;NONE&#39;`.</span>
<span class="sd">    * **QSO_SED** [:python:`str`]: QSO list file (full path)</span>
<span class="sd">    * **QSO_FSCALE** [:python:`float`]: QSO flux scale</span>
<span class="sd">    * **QSO_LIB** [:python:`str`]: QSO library to use (default libraries found at :file:`LEPHAREWORK/lib_bin`). To not use a QSO library, provide :python:`&#39;NONE&#39;`.</span>
<span class="sd">    * **GAL_SED** [:python:`str`]: galaxy library list file (full path)</span>
<span class="sd">    * **GAL_FSCALE** [:python:`float`]: galaxy flux scale</span>
<span class="sd">    * **GAL_LIB** [:python:`str`]: galaxy library to use (default libraries found at :file:`$LEPHAREWORK/lib_bin`). To not use a galaxy library, provide :python:`&#39;NONE&#39;`.</span>
<span class="sd">    * **SEL_AGE** [:python:`str`]: stellar ages list (full path)</span>
<span class="sd">    * **AGE_RANGE** [:python:`list[float]`]: minimum and maximum ages in years</span>
<span class="sd">    * **FILTER_LIST** [:python:`list[str]`]: list of filter names used for the fit (must all be located in :file:`$LEPHAREDIR/filt directory`)</span>
<span class="sd">    * **TRANS_TYPE** [:python:`int`]: transmission type (:python:`0` for Energy, :python:`1` for photons)</span>
<span class="sd">    * **FILTER_CALIB** [:python:`int`]: filter calibration (:python:`0` for fnu=ctt, :python:`1` for nu.fnu=ctt, :python:`2` for fnu=nu, :python:`3` for fnu=Black Body @ T=10000K, :python:`4` for MIPS (leff with nu fnu=ctt and flux with BB @ 10000K) </span>
<span class="sd">    * **FILTER_FILE** [:python:`str`]: filter file (must be located in :file:`$LEPHAREWORK/filt` directory)</span>
<span class="sd">    * **STAR_LIB_IN** [:python:`str`]: input stellar library (dupplicate with **STAR_LIB** ?)</span>
<span class="sd">    * **STAR_LIB_OUT** [:python:`str`]: output stellar magnitudes</span>
<span class="sd">    * **QSO_LIB_IN** [:python:`str`]: input QSO library (dupplicate with **QSO_LIB** ?)</span>
<span class="sd">    * **QSO_LIB_OUT** [:python:`str`]: output QSO magnitudes</span>
<span class="sd">    * **GAL_LIB_IN** [:python:`str`]: input galaxy library (dupplicate with **GAL_LIB** ?)</span>
<span class="sd">    * **GAL_LIB_OUT** [:python:`str`]: output galaxy magnitudes</span>
<span class="sd">    * **MAGTYPE** [:py:class:`~.MagType`]: magnitude system used (:py:attr:`~.MagType.AB` or :py:attr:`~.MagType.VEGA`)</span>
<span class="sd">    * **Z_STEP** [:python:`list[int/float]`]: redshift step properties. Values are in this order: redshift step, max redshift, redshift step for redshifts above 6 (coarser sampling).</span>
<span class="sd">    * **COSMOLOGY** [:python:`list[int/float]`]: cosmology parameters. Values are in this order: Hubble constant :math:`H_0`, baryon fraction :math:`\Omega_{m, 0}`, cosmological constant fraction :math:`\Omega_{\lambda, 0}`.</span>
<span class="sd">    * **MOD_EXTINC** [:python:`list[int/float]`]: minimum and maximum model extinctions</span>
<span class="sd">    * **EXTINC_LAW** [:python:`str`]: extinction law file (in :file:`$LEPHAREDIR/ext`)</span>
<span class="sd">    * **EB_V** [:python:`list[int/float]`]: color excess :math:`E(B-V)`. It must contain less than 50 values.</span>
<span class="sd">    * **EM_LINES** [:py:class:`~.YESNO`]: whether to consider emission lines or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **BD_SCALE** [:python:`int`]: number of bands used for scaling (:python:`0` means all bands). See LePhare documentation for more details.</span>
<span class="sd">    * **GLB_CONTEXT** [:python:`int`]: context number (:python:`0` means all bands). See LePhare documentation for more details.</span>
<span class="sd">    * **ERR_SCALE** [:python:`list[int/float]`]: magnitude errors per band to add in quadrature</span>
<span class="sd">    * **ERR_FACTOR** [:python:`int/float`]: scaling factor to apply to the errors</span>
<span class="sd">    * **ZPHOTLIB** [:python:`list[str]`]: librairies used to compute the :math:`\chi^2`. Maximum number is :python:`3`.</span>
<span class="sd">    * **ADD_EMLINES** [:py:class:`~.YESNO`]: whether to add emission lines or not (dupplicate with **EM_LINES** ?). Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **FIR_LIB** [:python:`str`]: far IR library</span>
<span class="sd">    * **FIR_LMIN** [:python:`int/float`]: minimum wavelength (in microns) for the far IR analysis</span>
<span class="sd">    * **FIR_CONT** [:python:`int/float`]: far IR continuum. Use :python:`-1` for no continuum.</span>
<span class="sd">    * **FIR_SCALE** [:python:`int/float`]: far IR flux scale. Use :python:`-1` to skip flux scale.</span>
<span class="sd">    * **FIR_FREESCALE** [:python:`str`]: whether to let the far IR spectrum freely scale</span>
<span class="sd">    * **FIR_SUBSTELLAR** [:python:`str`]: ???</span>
<span class="sd">    * **PHYS_LIB** [:python:`str`]: physical stochastic library</span>
<span class="sd">    * **PHYS_CONT** [:python:`int/float`]: physical continuum. Use :python:`-1` for no continuum.</span>
<span class="sd">    * **PHYS_SCALE** [:python:`int/float`]: physical flux scale. Use :python:`-1` to skip flux scale.</span>
<span class="sd">    * **PHYS_NMAX** [:python:`int`]: ???</span>
<span class="sd">    * **MAG_ABS** [:python:`list[int/float]`]: minimum and maximum values for the magnitudes.</span>
<span class="sd">    * **MAG_REF** [:python:`int`]: reference band used by **MAG_ABS**</span>
<span class="sd">    * **Z_RANGE** [:python:`list[int/float]`]: minimum and maximum redshifts used by the galaxy library</span>
<span class="sd">    * **EBV_RANGE** [:python:`list[int/float]`]: minimum and maximum colour excess :math:`E(B-V)`</span>
<span class="sd">    * **ZFIX** [:py:class:`~.YESNO`]: whether to fix the redshift or let it free. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **Z_INTERP** [:py:class:`~.YESNO`]: whether to perform an interpolation to find the redshift. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **DZ_WIN** [:python:`int/float`]: window search for second peak. Must be between :python:`0` and :python:`5`.</span>
<span class="sd">    * **MIN_THRES** [:python:`int/float`]: minimum threshold for second peak. Must be between :python:`0` and :python:`1`.</span>
<span class="sd">    * **MABS_METHOD** [:python:`int`]: method used to compute magnitudes (:python:`0` : obs-&gt;Ref, :python:`1` : best obs-&gt;Ref, :python:`2` : fixed obs-&gt;Ref, :python:`3` : mag from best SED, :python:`4` : Zbin). See LePhare documentation for more details.</span>
<span class="sd">    * **MABS_CONTEXT** [:python:`int`]: context for absolute magnitudes. See LePhare documentation for more details.</span>
<span class="sd">    * **MABS_REF** [:python:`int`]: reference band used to compute the absolute magnitudes. This is only used if :python:`MABS_METHOD = 2`.</span>
<span class="sd">    * **MABS_FILT** [:python:`list[int]`]: filters used in each redshift bin (see **MABS_ZBIN**). This is only used if :python:`MABS_METHOD = 4`.</span>
<span class="sd">    * **MABS_ZBIN** [:python:`list[int/float]`]: redshift bins (must be an even number). This is only used if :python:`MABS_METHOD = 4`.</span>
<span class="sd">    * **SPEC_OUT** [:py:class:`~.YESNO`]: whether to output the spectrum of each object or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **CHI2_OUT** [:py:class:`~.YESNO`]: whether to generate an output file with all the values or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~YESNO.NO`.</span>
<span class="sd">    * **PDZ_OUT** [:python:`str`]: output file name for the PDZ analysis. To not do the pdz analysis, provide :python:`&#39;NONE&#39;`.</span>
<span class="sd">    * **PDZ_MABS_FILT** [:python:`list[int]`]: absolute magnitude for reference filters to be extracted. See LePhare documentation for more details.</span>
<span class="sd">    * **FAST_MODE** [:py:class:`~.YESNO`]: whether to perform a fast computation or not. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **COL_NUM** [:python:`int`]: number of colors used</span>
<span class="sd">    * **COL_SIGMA** [:python:`int/float`]: quantity by which to enlarge the errors on the colors</span>
<span class="sd">    * **COL_SEL** [:py:class:`~.ANDOR`]: operation used to combine colors. Accepted values are :py:attr:`~.ANDOR.AND` or :py:attr:`~.ANDOR.OR`.</span>
<span class="sd">    * **AUTO_ADAPT** [:py:class:`~.YESNO`]: whether to use an adaptive method with a z-spec sample. Accepted values are :py:attr:`~.YESNO.YES` or :py:attr:`~.YESNO.NO`.</span>
<span class="sd">    * **ADAPT_BAND** [:python:`list[int]`]: reference band, band1 and band2 for colors</span>
<span class="sd">    * **ADAPT_LIM** [:python:`list[int/float]`]: magnitude limit for spectro in reference band</span>
<span class="sd">    * **ADAPT_POLY** [:python:`int`]: number of coefficients in polynomial. Maximum is :python:`4`.</span>
<span class="sd">    * **ADAPT_METH** [:python:`int`]: fit method, :python:`1` for color model, :python:`2` for redshift, :python:`3` for models. See LePhare documentation for more details.</span>
<span class="sd">    * **ADAPT_CONTEXT** [:python:`int`]: context for the bands used for training. See LePhare documentation for more details.</span>
<span class="sd">    * **ADAPT_ZBIN** [:python:`list[int/float]`]: minimum and maximum redshift interval used for training.</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;properties parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a dict.&#39;</span><span class="p">)</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#: Will be used to generate a custom directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">Any</span>         <span class="o">=</span> <span class="n">ID</span>
        
        <span class="c1"># Output parameter file is defined through the ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_output.para&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outParam</span>        <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">LePhareOutputParam</span><span class="p">}</span>
        
        <span class="c1">#: Allowed keys and corresponding allowed types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                     <span class="s1">&#39;STAR_SED&#39;</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;sed&#39;</span><span class="p">,</span> <span class="s1">&#39;STAR&#39;</span><span class="p">,</span> <span class="s1">&#39;STAR_MOD.list&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;STAR_FSCALE&#39;</span>    <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">3.432e-09</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;STAR_LIB&#39;</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_STAR_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;QSO_SED&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;sed&#39;</span><span class="p">,</span> <span class="s1">&#39;QSO&#39;</span><span class="p">,</span> <span class="s1">&#39;QSO_MOD.list&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;QSO_FSCALE&#39;</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;QSO_LIB&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_QSO_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;GAL_SED&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;sed&#39;</span><span class="p">,</span> <span class="s1">&#39;GAL&#39;</span><span class="p">,</span> <span class="s1">&#39;BC03_CHAB&#39;</span><span class="p">,</span> <span class="s1">&#39;BC03_MOD.list&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;GAL_FSCALE&#39;</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;GAL_LIB&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;SEL_AGE&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;sed&#39;</span><span class="p">,</span> <span class="s1">&#39;GAL&#39;</span><span class="p">,</span> <span class="s1">&#39;BC03_CHAB&#39;</span><span class="p">,</span> <span class="s1">&#39;BC03_AGE.list&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;AGE_RANGE&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">3e9</span><span class="p">,</span> <span class="mf">11e9</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                                                 <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                 <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;AGE_RANGE property must be a length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FILTER_LIST&#39;</span>    <span class="p">:</span> <span class="n">ListPathProperty</span><span class="p">([</span><span class="s1">&#39;hst/acs_f435w.pb&#39;</span><span class="p">,</span> <span class="s1">&#39;hst/acs_f606w.pb&#39;</span><span class="p">,</span> <span class="s1">&#39;hst/acs_f775w.pb&#39;</span><span class="p">,</span> <span class="s1">&#39;hst/acs_f850lp.pb&#39;</span><span class="p">],</span> 
                                                         <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;filt&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;TRANS_TYPE&#39;</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FILTER_CALIB&#39;</span>   <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FILTER_FILE&#39;</span>    <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;HDF_bc03.filt&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;filt&#39;</span><span class="p">),</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;STAR_LIB_IN&#39;</span>    <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_STAR_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;STAR_LIB_OUT&#39;</span>   <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;STAR_HDF_bc03&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;QSO_LIB_IN&#39;</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_QSO_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;QSO_LIB_OUT&#39;</span>    <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;QSO_HDF_bc03&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;GAL_LIB_IN&#39;</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;LIB_bc03&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREWORK&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_bin&#39;</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.bin&#39;</span><span class="p">,</span> <span class="n">skipCheckPath</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                     
                     <span class="s1">&#39;GAL_LIB_OUT&#39;</span>    <span class="p">:</span> <span class="n">StrProperty</span><span class="p">(</span><span class="s1">&#39;HDF_bc03&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MAGTYPE&#39;</span>        <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">MagType</span><span class="o">.</span><span class="n">AB</span><span class="p">),</span>
                     
                     <span class="s1">&#39;Z_STEP&#39;</span>         <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;Z_STEP property must be a length 3 list where the last step must be larger than the first one.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;COSMOLOGY&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">70.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">,</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;Z_STEP property must be a length 3 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MOD_EXTINC&#39;</span>     <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">27</span><span class="p">],</span>
                                                 <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                 <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;MOD_EXTINC property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;EXTINC_LAW&#39;</span>     <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;calzetti.dat&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;$LEPHAREDIR&#39;</span><span class="p">,</span> <span class="s1">&#39;ext&#39;</span><span class="p">)),</span>
                     
                     <span class="s1">&#39;EB_V&#39;</span>           <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">49</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">((</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))),</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;EB_V property must be an increasing list with a maximum length of 49.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;EM_LINES&#39;</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;LIB_ASCII&#39;</span>      <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;BD_SCALE&#39;</span>       <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;GLB_CONTEXT&#39;</span>    <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ERR_SCALE&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ERR_FACTOR&#39;</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ZPHOTLIB&#39;</span>       <span class="p">:</span> <span class="n">ListStrProperty</span><span class="p">([</span><span class="s1">&#39;HDF_bc03&#39;</span><span class="p">,</span> <span class="s1">&#39;STAR_HDF_bc03&#39;</span><span class="p">,</span> <span class="s1">&#39;QSO_HDF_bc03&#39;</span><span class="p">]),</span>
                     
                     <span class="s1">&#39;ADD_EMLINES&#39;</span>    <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_LIB&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;NONE&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_LMIN&#39;</span>       <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_CONT&#39;</span>       <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_SCALE&#39;</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_FREESCALE&#39;</span>  <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FIR_SUBSTELLAR&#39;</span> <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PHYS_LIB&#39;</span>       <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;NONE&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PHYS_CONT&#39;</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PHYS_SCALE&#39;</span>     <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PHYS_NMAX&#39;</span>      <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MAG_ABS&#39;</span>        <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">,</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;MAG_ABS property must be a length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MAG_REF&#39;</span>        <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;Z_RANGE&#39;</span>        <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;Z_RANGE property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;EBV_RANGE&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;EBV_RANGE_RANGE property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ZFIX&#39;</span>           <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">YES</span><span class="p">),</span>
                     
                     <span class="s1">&#39;Z_INTERP&#39;</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;DZ_WIN&#39;</span>         <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MIN_THRES&#39;</span>      <span class="p">:</span> <span class="n">FloatProperty</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MABS_METHOD&#39;</span>    <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MABS_CONTEXT&#39;</span>   <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MABS_REF&#39;</span>       <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MABS_FILT&#39;</span>      <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;MABS_ZBIN&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">((</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))),</span> 
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;MABS_ZBIN property must be an increasing list with an even length.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;SPEC_OUT&#39;</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;CHI2_OUT&#39;</span>       <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PDZ_OUT&#39;</span>        <span class="p">:</span> <span class="n">PathProperty</span><span class="p">(</span><span class="s1">&#39;NONE&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;PDZ_MABS_FILT&#39;</span>  <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;FAST_MODE&#39;</span>      <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;COL_NUM&#39;</span>        <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;COL_SIGMA&#39;</span>      <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;COL_SEL&#39;</span>        <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">ANDOR</span><span class="o">.</span><span class="n">AND</span><span class="p">),</span>
                     
                     <span class="s1">&#39;AUTO_ADAPT&#39;</span>     <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_BAND&#39;</span>     <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_LIM&#39;</span>      <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">],</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;ADAPT_LIM property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_POLY&#39;</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_METH&#39;</span>     <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_CONTEXT&#39;</span>  <span class="p">:</span> <span class="n">IntProperty</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_ZBIN&#39;</span>     <span class="p">:</span> <span class="n">ListFloatProperty</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                          <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;ADAPT_ZBIN property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ADAPT_MODBIN&#39;</span>   <span class="p">:</span> <span class="n">ListIntProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="n">minBound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxBound</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                        <span class="n">testFunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                        <span class="n">testMsg</span><span class="o">=</span><span class="s1">&#39;ADAPT_MODBIN property must be an increasing length 2 list.&#39;</span><span class="p">),</span>
                     
                     <span class="s1">&#39;ERROR_ADAPT&#39;</span>    <span class="p">:</span> <span class="n">EnumProperty</span><span class="p">(</span><span class="n">YESNO</span><span class="o">.</span><span class="n">NO</span><span class="p">)</span>
                     <span class="p">}</span>
        
        <span class="c1"># Set properties given by the user</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> in properties has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type str&#39;</span><span class="p">)</span>
            
            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> in properties does not correspond to a valid item name.&#39;</span><span class="p">)</span>
                
            <span class="c1"># Set Property value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        
    <span class="c1">###############################</span>
    <span class="c1">#       Text formatting       #</span>
    <span class="c1">###############################</span>
    
<div class="viewcode-block" id="LePhareSED.output_parameters"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.LePhareSED.output_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">output_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate an output parameter file used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param params: list of parameters to activate in the ouput parameters file</span>
<span class="sd">        :type params: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        .. note ::</span>
<span class="sd">            </span>
<span class="sd">            To know which output parameters can be passed print outParam property, i.e.</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; sed = LePhareSED(&#39;identifier&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(sed.outParams)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;params has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;one of the values in params is not of type str.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Check and then set given parameters to True</span>
        <span class="n">newParams</span>                <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outParam</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newParams</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">WARNING</span><span class="si">}</span><span class="s1"> invalid parameter name </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newParams</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1"># Produce the formatted string</span>
        <span class="k">return</span> <span class="s1">&#39;IDENT</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;#</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">newParams</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span></div>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Generate a parameter file text used by the SED fitting code.</span>
<span class="sd">        </span>
<span class="sd">        :returns: the text</span>
<span class="sd">        :rtype: :python:`str`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># %INPUTCATALOGUEINFORMATION% is replaced when the run method is launched</span>
        
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">        ##############################################################################</span>
<span class="s1">        #                CREATION OF LIBRARIES FROM SEDs List                        #</span>
<span class="s1">        # $LEPHAREDIR/source/sedtolib -t (S/Q/G) -c $LEPHAREDIR/config/zphot.para    #</span>
<span class="s1">        # help : $LEPHAREDIR/source/sedtolib -h (or -help)                           #</span>
<span class="s1">        ##############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        #------      STELLAR LIBRARY (ASCII SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        STAR_SED </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_SED&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># STAR list (full path)</span>
<span class="s1">        STAR_FSCALE</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_FSCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale</span>
<span class="s1">        STAR_LIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_LIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. STAR LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        #</span>
<span class="s1">        #------      QSO LIBRARY (ASCII SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        QSO_SED </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_SED&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># QSO list (full path)</span>
<span class="s1">        QSO_FSCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_FSCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale </span>
<span class="s1">        QSO_LIB	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_LIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. QSO LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        #</span>
<span class="s1">        #------      GALAXY LIBRARY (ASCII or BINARY SEDs)</span>
<span class="s1">        #</span>
<span class="s1">        GAL_SED	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_SED&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># GAL list (full path)</span>
<span class="s1">        GAL_FSCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_FSCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Arbitrary Flux Scale</span>
<span class="s1">        GAL_LIB	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_LIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bin. GAL LIBRARY -&gt; $LEPHAREWORK/lib_bin</span>
<span class="s1">        SEL_AGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;SEL_AGE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Age list(full path, def=NONE)	</span>
<span class="s1">        AGE_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;AGE_RANGE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Age Min-Max in yr</span>
<span class="s1">        #</span>
<span class="s1">        #############################################################################</span>
<span class="s1">        #                           FILTERS                                         #</span>
<span class="s1">        #  $LEPHAREDIR/source/filter  -c $LEPHAREDIR/config/zphot.para              #</span>
<span class="s1">        #  help: $LEPHAREDIR/source/filter  -h (or -help)                           #</span>
<span class="s1">        #############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        FILTER_LIST </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FILTER_LIST&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># (in $LEPHAREDIR/filt/*)</span>
<span class="s1">        TRANS_TYPE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;TRANS_TYPE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># TRANSMISSION TYPE</span>
<span class="s1">        FILTER_CALIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FILTER_CALIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def]: fnu=ctt, 1: nu.fnu=ctt, 2: fnu=nu, 3: fnu=Black Body @ T=10000K, 4: for MIPS (leff with nu fnu=ctt and flux with BB @ 10000K</span>
<span class="s1">        FILTER_FILE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FILTER_FILE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># output name of filter&#39;s file -&gt; $LEPHAREWORK/filt/</span>
<span class="s1">        #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #                 THEORETICAL  MAGNITUDES                                  #</span>
<span class="s1">        # $LEPHAREDIR/source/mag_star -c  $LEPHAREDIR/config/zphot.para (star only)#</span>
<span class="s1">        # help: $LEPHAREDIR/source/mag_star -h (or -help)                          #</span>
<span class="s1">        # $LEPHAREDIR/source/mag_gal  -t (Q or G) -c $LEPHAREDIR/config/zphot.para #</span>
<span class="s1">        #                                                         (for gal. &amp; QSO) #</span>
<span class="s1">        # help: $LEPHAREDIR/source/mag_gal  -h (or -help)                          #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From STELLAR LIBRARY</span>
<span class="s1">        #</span>
<span class="s1">        STAR_LIB_IN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_LIB_IN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input STELLAR LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        STAR_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_LIB_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output STELLAR MAGN -&gt; $LEPHAREWORK/lib_mag/</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From QSO     LIBRARY   </span>
<span class="s1">        #</span>
<span class="s1">        QSO_LIB_IN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_LIB_IN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input QSO LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        QSO_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_LIB_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output QSO MAGN -&gt; $LEPHAREWORK/lib_mag/</span>
<span class="s1">        #</span>
<span class="s1">        #-------     From GALAXY  LIBRARY  </span>
<span class="s1">        #</span>
<span class="s1">        GAL_LIB_IN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_LIB_IN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Input GAL LIBRARY in $LEPHAREWORK/lib_bin/</span>
<span class="s1">        GAL_LIB_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_LIB_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Output GAL LIBRARY -&gt; $LEPHAREWORK/lib_mag/ </span>
<span class="s1">        #</span>
<span class="s1">        #-------   MAG + Z_STEP + EXTINCTION + COSMOLOGY</span>
<span class="s1">        #</span>
<span class="s1">        MAGTYPE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MAGTYPE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Magnitude type (AB or VEGA)</span>
<span class="s1">        Z_STEP </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;Z_STEP&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># dz, zmax, dzsup(if zmax&gt;6)</span>
<span class="s1">        COSMOLOGY </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;COSMOLOGY&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># H0,om0,lbd0 (if lb0&gt;0-&gt;om0+lbd0=1)</span>
<span class="s1">        MOD_EXTINC </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MOD_EXTINC&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># model range for extinction </span>
<span class="s1">        EXTINC_LAW </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;EXTINC_LAW&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># ext. law (in $LEPHAREDIR/ext/*)</span>
<span class="s1">        EB_V </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;EB_V&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># E(B-V) (&lt;50 values)</span>
<span class="s1">        EM_LINES </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;EM_LINES&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        # Z_FORM 	8,7,6,5,4,3 	# Zformation for each SED in GAL_LIB_IN</span>
<span class="s1">        #</span>
<span class="s1">        #-------   ASCII OUTPUT FILES OPTION</span>
<span class="s1">        #</span>
<span class="s1">        LIB_ASCII </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;LIB_ASCII&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Writes output in ASCII in working directory</span>
<span class="s1">        #</span>
<span class="s1">        ############################################################################</span>
<span class="s1">        #              PHOTOMETRIC REDSHIFTS                                       #</span>
<span class="s1">        # $LEPHAREDIR/source/zphot -c $LEPHAREDIR/config/zphot.para                #</span>
<span class="s1">        # help: $LEPHAREDIR/source/zphot -h (or -help)                             #</span>
<span class="s1">        ############################################################################ </span>
<span class="s1">        #</span>
<span class="s1">        %INPUTCATALOGUEINFORMATION%</span>
<span class="s1">        CAT_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">.out </span><span class="se">\t</span>
<span class="s1">        PARA_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Ouput parameter (full path)</span>
<span class="s1">        BD_SCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;BD_SCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Bands used for scaling (Sum 2^n; n=0-&gt;nbd-1, 0[-def]:all bands)</span>
<span class="s1">        GLB_CONTEXT</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GLB_CONTEXT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Overwrite Context (Sum 2^n; n=0-&gt;nbd-1, 0 : all bands used, -1[-def]: used context per object)</span>
<span class="s1">        # FORB_CONTEXT -1               # context for forbitten bands</span>
<span class="s1">        ERR_SCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ERR_SCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># errors per band added in quadrature</span>
<span class="s1">        ERR_FACTOR </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ERR_FACTOR&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># error scaling factor 1.0 [-def]       </span>
<span class="s1">        #</span>
<span class="s1">        #-------    Theoretical libraries</span>
<span class="s1">        #</span>
<span class="s1">        ZPHOTLIB </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ZPHOTLIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Library used for Chi2 (max:3)</span>
<span class="s1">        ADD_EMLINES</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADD_EMLINES&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        #</span>
<span class="s1">        ########    PHOTOMETRIC REDSHIFTS OPTIONS      ###########</span>
<span class="s1">        #</span>
<span class="s1">        # FIR LIBRARY</span>
<span class="s1">        #</span>
<span class="s1">        FIR_LIB </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_LIB&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        FIR_LMIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_LMIN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Lambda Min (micron) for FIR analysis </span>
<span class="s1">        FIR_CONT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_CONT&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        FIR_SCALE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_SCALE&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        FIR_FREESCALE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_FREESCALE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># ALLOW FOR FREE SCALING </span>
<span class="s1">        FIR_SUBSTELLAR </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FIR_SUBSTELLAR&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        #</span>
<span class="s1">        # PHYSICAL LIBRARY with Stochastic models from  BC07  </span>
<span class="s1">        #</span>
<span class="s1">        PHYS_LIB </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PHYS_LIB&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">  </span>
<span class="s1">        PHYS_CONT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PHYS_CONT&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        PHYS_SCALE </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PHYS_SCALE&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        PHYS_NMAX </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PHYS_NMAX&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s1">        #</span>
<span class="s1">        #-------     Priors  </span>
<span class="s1">        #</span>
<span class="s1">        # MASS_SCALE	0.,0.		# Lg(Scaling) min,max [0,0-def]</span>
<span class="s1">        MAG_ABS </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MAG_ABS&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Mabs_min, Mabs_max [0,0-def]</span>
<span class="s1">        MAG_REF </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MAG_REF&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Reference number for band used by Mag_abs</span>
<span class="s1">        # ZFORM_MIN	5,5,5,5,5,5,3,1	# Min. Zformation per SED -&gt; Age constraint</span>
<span class="s1">        Z_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;Z_RANGE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Z min-max used for the Galaxy library </span>
<span class="s1">        EBV_RANGE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;EBV_RANGE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># E(B-V) MIN-MAX RANGE of E(B-V) used  </span>
<span class="s1">        # NZ_PRIOR      4,2,4           # I Band for prior on N(z)</span>
<span class="s1">        #                          </span>
<span class="s1">        #-------     Fixed Z   (need format LONG for input Cat)</span>
<span class="s1">        #</span>
<span class="s1">        ZFIX </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ZFIX&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># fixed z and search best model [YES,NO-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------     Parabolic interpolation for Zbest  </span>
<span class="s1">        #</span>
<span class="s1">        Z_INTERP </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;Z_INTERP&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># redshift interpolation [YES,NO-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------  Analysis of normalized ML(exp-(0.5*Chi^2)) curve </span>
<span class="s1">        #-------  Secondary peak analysis       </span>
<span class="s1">        #</span>
<span class="s1">        DZ_WIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;DZ_WIN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Window search for 2nd peaks [0-&gt;5;0.25-def]</span>
<span class="s1">        MIN_THRES </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MIN_THRES&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Lower threshold for 2nd peaks[0-&gt;1; 0.1-def]</span>
<span class="s1">        #</span>
<span class="s1">        #-------  Probability (in %) per redshift intervals</span>
<span class="s1">        #</span>
<span class="s1">        # PROB_INTZ     0,0.5,0.5,1.,1.,1.5     # even number</span>
<span class="s1">        #</span>
<span class="s1">        #########    ABSOLUTE MAGNITUDES COMPUTATION   ###########</span>
<span class="s1">        #</span>
<span class="s1">        MABS_METHOD </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MABS_METHOD&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def] : obs-&gt;Ref, 1 : best  obs-&gt;Ref, 2 : fixed obs-&gt;Ref, 3 : mag from best SED, 4 : Zbin</span>
<span class="s1">        MABS_CONTEXT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MABS_CONTEXT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># CONTEXT for Band used for MABS </span>
<span class="s1">        MABS_REF </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MABS_REF&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># 0[-def]: filter obs chosen for Mabs (ONLY USED IF MABS_METHOD=2)</span>
<span class="s1">        MABS_FILT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MABS_FILT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Chosen filters per redshift bin (MABS_ZBIN - ONLY USED IF MABS_METHOD=4)</span>
<span class="s1">        MABS_ZBIN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;MABS_ZBIN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Redshift bins (even number - ONLY USED IF MABS_METHOD=4)</span>
<span class="s1">        #</span>
<span class="s1">        #########   OUTPUT SPECTRA                     ###########</span>
<span class="s1">        #</span>
<span class="s1">        SPEC_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;SPEC_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># spectrum for each object? [YES,NO-def]</span>
<span class="s1">        CHI2_OUT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;CHI2_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"># output file with all values : z,mod,chi2,E(B-V),... BE CAREFUL can take a lot of space !!</span>
<span class="s1">        #</span>
<span class="s1">        #########  OUTPUT PDZ ANALYSIS  </span>
<span class="s1">        #</span>
<span class="s1">        PDZ_OUT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PDZ_OUT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># pdz output file name [def-NONE] - add automatically PDZ_OUT[.pdz/.mabsx/.mod/.zph] </span>
<span class="s1">        PDZ_MABS_FILT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PDZ_MABS_FILT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># MABS for REF FILTERS to be extracted</span>
<span class="s1">        # </span>
<span class="s1">        #########   FAST MODE : color-space reduction        #####</span>
<span class="s1">        #</span>
<span class="s1">        FAST_MODE </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;FAST_MODE&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Fast computation [NO-def] </span>
<span class="s1">        COL_NUM	</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;COL_NUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Number of colors used [3-def]</span>
<span class="s1">        COL_SIGMA </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;COL_SIGMA&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Enlarge of the obs. color-errors[3-def]</span>
<span class="s1">        COL_SEL </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;COL_SEL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Combination between used colors [AND/OR-def]</span>
<span class="s1">        #</span>
<span class="s1">        #########   MAGNITUDE SHIFTS applied to libraries   ######</span>
<span class="s1">        #</span>
<span class="s1">        # APPLY_SYSSHIFT  0.             # Apply systematic shifts in each band</span>
<span class="s1">                                         # used only if number of shifts matches</span>
<span class="s1">                                         # with number of filters in the library    </span>
<span class="s1">        #</span>
<span class="s1">        #########   ADAPTIVE METHOD using Z spectro sample     ###</span>
<span class="s1">        #</span>
<span class="s1">        AUTO_ADAPT </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;AUTO_ADAPT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Adapting method with spectro [NO-def]</span>
<span class="s1">        ADAPT_BAND </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_BAND&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Reference band, band1, band2 for color </span>
<span class="s1">        ADAPT_LIM </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_LIM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Mag limits for spectro in Ref band [18,21.5-def]</span>
<span class="s1">        ADAPT_POLY </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_POLY&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Number of coef in  polynom (max=4) [1-def]</span>
<span class="s1">        ADAPT_METH </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_METH&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Fit as a function of 1 : Color Model  [1-def], 2 : Redshift, 3 : Models</span>
<span class="s1">        ADAPT_CONTEXT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_CONTEXT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Context for bands used for training, -1[-def] used context per object</span>
<span class="s1">        ADAPT_ZBIN </span><span class="se">\t\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_ZBIN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Redshift&#39;s interval used for training [0.001,6-Def]</span>
<span class="s1">        ADAPT_MODBIN </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ADAPT_MODBIN&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># Model&#39;s interval used for training [1,1000-Def]</span>
<span class="s1">        ERROR_ADAPT </span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ERROR_ADAPT&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># [YES,NO-def] Add error in quadrature according to the difference between observed and predicted apparent magnitudes </span>
<span class="s1">        #</span>
<span class="s1">        &#39;&#39;&#39;</span>      
        
        <span class="k">return</span> <span class="n">text</span>
    
    <span class="c1">#############################</span>
    <span class="c1">#        Run methods        #</span>
    <span class="c1">#############################</span>
    
<div class="viewcode-block" id="LePhareSED.runScript"><a class="viewcode-back" href="../../API/sed.html#pixSED.sed.LePhareSED.runScript">[docs]</a>    <span class="k">def</span> <span class="nf">runScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                  <span class="n">commands</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                  <span class="n">file</span>     <span class="p">:</span> <span class="nb">str</span>        <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
                  <span class="n">log</span>      <span class="p">:</span> <span class="n">TextIOBase</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                  <span class="n">errMsg</span>   <span class="p">:</span> <span class="nb">str</span>        <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="n">test</span>     <span class="p">:</span> <span class="nb">bool</span>       <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">testMsg</span>  <span class="p">:</span> <span class="nb">str</span>        <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Wrapper around default :py:meth:`~.SED.startProcess` which allows to separately provide the commands and the file.</span>
<span class="sd">        </span>
<span class="sd">        :param commands: list of commands to use with Popen</span>
<span class="sd">        :type commands: :python:`list[str]`</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param file: file to run the process or script against</span>
<span class="sd">        :type file: :python:`str`</span>
<span class="sd">        :param log: oppened log file</span>
<span class="sd">        :type log: `TextIOBase`_</span>
<span class="sd">        :param errMsg: message error to show if the process failed</span>
<span class="sd">        :type errMsg: :python:`str`</span>
<span class="sd">        :param test: a test that must be passed at the end of the command for the program to continue</span>
<span class="sd">        :type test: :python:`bool`</span>
<span class="sd">        :param testMsg: a test that must be passed at the end of the command for the program to continue</span>
<span class="sd">        :type testMsg: :python:`str`</span>
<span class="sd">        </span>
<span class="sd">        :raises TypeError: if **commands** if not of type :python:`list`</span>
<span class="sd">        :raises ValueError: if **testFunc** returns :python:`False`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;commands parameter has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must have type list.&#39;</span><span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startProcess</span><span class="p">(</span><span class="n">commands</span> <span class="o">+</span> <span class="p">[</span><span class="n">file</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">errMsg</span><span class="o">=</span><span class="n">errMsg</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">testMsg</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">genQSOModel</span>  <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/sedtolib&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;QSO&#39;</span><span class="p">,</span>     <span class="s1">&#39;-c&#39;</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;QSO models generation failed.&#39;</span><span class="p">)</span>
    <span class="n">genGalModel</span>  <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/sedtolib&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;Galaxy&#39;</span><span class="p">,</span>  <span class="s1">&#39;-c&#39;</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;Galaxy models generation failed.&#39;</span><span class="p">)</span>
    <span class="n">genStarModel</span> <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/sedtolib&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;Stellar&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span> <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;Stellar models generation failed.&#39;</span><span class="p">)</span>
    <span class="n">genFilters</span>   <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/filter&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span>                    <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;Filters generation failed.&#39;</span><span class="p">)</span>
    <span class="n">genMagQSO</span>    <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/mag_gal&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span>        <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;QSO magnitudes failed.&#39;</span><span class="p">)</span>
    <span class="n">genMagStar</span>   <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/mag_star&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span>                  <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;Stellar magnitudes failed.&#39;</span><span class="p">)</span>
    <span class="n">genMagGal</span>    <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/mag_gal&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span>        <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;Galaxy magnitudes failed.&#39;</span><span class="p">)</span>
    <span class="n">startLePhare</span> <span class="o">=</span> <span class="n">partialmethod</span><span class="p">(</span><span class="n">runScript</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$LEPHAREDIR/source/zphota&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">],</span>                    <span class="n">errMsg</span><span class="o">=</span><span class="s1">&#39;SED fitting failed.&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalogue</span><span class="p">:</span> <span class="n">LePhareCat</span><span class="p">,</span> 
                 <span class="n">outputParams</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> 
                 <span class="n">skipSEDgen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipFilterGen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagQSO</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagStar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                 <span class="n">skipMagGal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LePhareOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. codeauthor:: Wilfried Mercier - IRAP/LAM &lt;wilfried.mercier@lam.fr&gt;</span>
<span class="sd">        </span>
<span class="sd">        Start the SED fitting on the given data using the built-in SED fitting parameters.</span>
<span class="sd">        </span>
<span class="sd">        :param LePhareCat catalogue: catalogue to use for the SED-fitting</span>
<span class="sd">        </span>
<span class="sd">        **Keyword arguments**</span>
<span class="sd">        </span>
<span class="sd">        :param outputParams: output parameters</span>
<span class="sd">        :type outputParams: :python:`list[str]`</span>
<span class="sd">        :param skipSEDgen: whether to skip the SED models generation. Useful to gain time if the same SED are used for multiple sources.</span>
<span class="sd">        :type skipSEDgen: :python:`bool`</span>
<span class="sd">        :param skipFilterGen: whether to skip the filters generation. Useful to gain time if the same filters are used for multiple sources.</span>
<span class="sd">        :type skipFilterGen: :python:`bool`</span>
<span class="sd">        :param skipMagQSO: whether to skip the predicted magnitude computations for the QS0. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagQSO: :python:`bool`</span>
<span class="sd">        :param skipMagStar: whether to skip the predicted magnitude computations for the stars. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagStar: :python`bool`</span>
<span class="sd">        :param skipMagGal: whether to skip the predicted magnitude computations for the galaxies. Useful to gain time if the same libraries/parameters are used for multiple sources.</span>
<span class="sd">        :type skipMagGal: :python:`bool`</span>

<span class="sd">        :returns: LePhare output file object with data from the file loaded</span>
<span class="sd">        :rtype: LePhareOutput</span>

<span class="sd">        :raises TypeError: if **catalogue** is not of type :py:class:`~.LePhareCat`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">catalogue</span><span class="p">,</span> <span class="n">LePhareCat</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;catalogue has type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">catalogue</span><span class="p">)</span><span class="si">}</span><span class="s1"> but it must be a LePhareCat instance.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Make output directory</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opath</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
        <span class="c1"># Different SED fitting output file names</span>
        <span class="n">paramFile</span> <span class="o">=</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.in&#39;</span><span class="p">,</span> <span class="s1">&#39;.para&#39;</span><span class="p">)</span>
        <span class="n">pfile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">paramFile</span><span class="p">)</span>
        <span class="n">logFile</span>   <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.in&#39;</span><span class="p">,</span> <span class="s1">&#39;_lephare.log&#39;</span><span class="p">))</span>
        <span class="n">oCatFile</span>  <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.in&#39;</span><span class="p">,</span> <span class="s1">&#39;.out&#39;</span><span class="p">))</span>
        
        <span class="c1"># Generate and write parameters file</span>
        <span class="n">params</span>    <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%INPUTCATALOGUEINFORMATION%&#39;</span><span class="p">,</span> <span class="n">catalogue</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            
        <span class="c1"># Write catalogue</span>
        <span class="n">catalogue</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        
        <span class="c1"># Generate and write output parameters file</span>
        <span class="n">oparams</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_parameters</span><span class="p">(</span><span class="n">outputParams</span><span class="p">)</span>
        <span class="n">ofile</span>     <span class="o">=</span> <span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputParamFile</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oparams</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logFile</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log</span><span class="p">:</span>

            <span class="c1">#########################################</span>
            <span class="c1">#          Generate SED models          #</span>
            <span class="c1">#########################################</span>
            
            <span class="c1"># Generate QSO, Star and Galaxy models</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipSEDgen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genQSOModel</span><span class="p">(</span> <span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genStarModel</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genGalModel</span><span class="p">(</span> <span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                
            <span class="c1">####################################</span>
            <span class="c1">#         Generate filters         #</span>
            <span class="c1">####################################</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipFilterGen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genFilters</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1">##############################################</span>
            <span class="c1">#        Compute predicted magnitudes        #</span>
            <span class="c1">##############################################</span>
            
            <span class="c1"># QSO magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagQSO</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagQSO</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_LIB&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">_checkPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;QSO_LIB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="p">),</span> <span class="n">testMsg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> QSO library </span><span class="si">{</span><span class="n">opath</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;QSO_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;QSO_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;QSO_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ext</span><span class="p">)</span><span class="si">}</span><span class="s1"> not found.&#39;</span><span class="p">)</span>
                
            <span class="c1"># Star magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagStar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagStar</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_LIB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_checkPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;STAR_LIB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">testMsg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> STAR library </span><span class="si">{</span><span class="n">opath</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;STAR_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;STAR_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;STAR_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ext</span><span class="p">)</span><span class="si">}</span><span class="s1"> not found.&#39;</span><span class="p">)</span>
                    
            <span class="c1"># Galaxy magnitudes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skipMagGal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">genMagGal</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pfile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_LIB&#39;</span> <span class="p">]</span><span class="o">.</span><span class="n">_checkPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;GAL_LIB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="p">),</span> <span class="n">testMsg</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ERROR</span><span class="si">}</span><span class="s1"> GAL library </span><span class="si">{</span><span class="n">opath</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">opath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;GAL_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;GAL_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s2">&quot;GAL_LIB&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ext</span><span class="p">)</span><span class="si">}</span><span class="s1"> not found.&#39;</span><span class="p">)</span>
            
            <span class="c1">###################################</span>
            <span class="c1">#         Run SED fitting         #</span>
            <span class="c1">###################################</span>
            
            <span class="c1"># Move to directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">startLePhare</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">paramFile</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            
            <span class="c1"># Move back to parent directory</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">LePhareOutput</span><span class="p">(</span><span class="n">oCatFile</span><span class="p">)</span> </div>
 
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2022-2024, Wilfried Mercier.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>